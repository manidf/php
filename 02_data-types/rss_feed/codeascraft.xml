<?xml version="1.0" encoding="UTF-8"?>
<feed
	xmlns="http://www.w3.org/2005/Atom"
	xmlns:thr="http://purl.org/syndication/thread/1.0"
	xml:lang="en-US"
	xml:base="https://codeascraft.com/wp-atom.php"
>
	<title type="text">Code as Craft</title>
	<subtitle type="text">The Engineering Blog from Etsy</subtitle>

	<updated>2017-05-26T20:32:21Z</updated>

	<link rel="alternate" type="text/html" href="https://codeascraft.com"/>
	<id>https://codeascraft.com/feed/atom/</id>
	<link rel="self" type="application/atom+xml" href="https://codeascraft.com/feed/atom/"/>

	<generator uri="https://wordpress.org/" version="4.7.5">WordPress</generator>
	<entry>
		<author>
			<name>Sasha Friedenberg</name>
		</author>
		<title type="html"><![CDATA[How Etsy Ships Apps]]></title>
		<link rel="alternate" type="text/html" href="https://codeascraft.com/2017/05/15/how-etsy-ships-apps/"/>
		<id>https://codeascraft.com/?p=4897</id>
		<updated>2017-05-16T15:40:18Z</updated>
		<published>2017-05-15T15:05:50Z</published>
		<category scheme="https://codeascraft.com" term="infrastructure"/>
		<category scheme="https://codeascraft.com" term="mobile"/>
		<category scheme="https://codeascraft.com" term="continuous deployment"/>
		<category scheme="https://codeascraft.com" term="deployinator"/>
		<category scheme="https://codeascraft.com" term="deployment"/>
		<summary type="html">
			<![CDATA[In which Etsy transforms its app release process by aligning it with its philosophy for web deploys Anchors Aweigh Deploying code should be easy. It should happen often, and it should involve its engineers. For Etsyweb, this looks like continuous deployment. A group of engineers (which we call a push train) and a designated driver [&#8230;]]]></summary>
		<content type="html" xml:base="https://codeascraft.com/2017/05/15/how-etsy-ships-apps/"><![CDATA[<p><em>In which Etsy transforms its app release process by aligning it with its philosophy for web deploys</em></p>
<p><a href="https://codeascraft.com/?attachment_id=4898"><img class="aligncenter wp-image-4898" src="https://codeascraft.com/wp-content/uploads/2017/05/1-Etsy-on-a-boat-300x140.png" alt="illustration of a boat on a wave. There are several people in the boat, and the boat has a flag with an &quot;E&quot; on it." width="500" height="233" srcset="https://codeascraft.com/wp-content/uploads/2017/05/1-Etsy-on-a-boat-300x140.png 300w, https://codeascraft.com/wp-content/uploads/2017/05/1-Etsy-on-a-boat-768x358.png 768w, https://codeascraft.com/wp-content/uploads/2017/05/1-Etsy-on-a-boat-1024x477.png 1024w, https://codeascraft.com/wp-content/uploads/2017/05/1-Etsy-on-a-boat.png 1600w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<h2>Anchors Aweigh</h2>
<p>Deploying code should be easy. It should happen often, and it should involve its engineers. For Etsyweb, this looks like continuous deployment.</p>
<p>A group of engineers (which we call a <a href="https://www.slideshare.net/premshree_pillai/continuous-deployment-at-etsy/81">push train</a>) and a designated driver all shepherd their changes to a staging environment, and then to production. At each checkpoint along that journey, the members of the push train are responsible for testing their changes, sharing that they’re ready to ship, and making sure nothing broke. Everyone in that train must work together for the safe completion of their deployment. And this happens very frequently: up to 50 times a day.</p>
<pre>                                               TOPIC: clear
 mittens&gt; .join                                TOPIC: mittens
   sasha&gt; .join with mittens                   TOPIC: mittens + sasha
 pushbot&gt; mittens, sasha: You're up            TOPIC: mittens + sasha
   sasha&gt; .good                                TOPIC: mittens + sasha*
 mittens&gt; .good                                TOPIC: mittens* + sasha*
 pushbot&gt; mittens, sasha: Everyone is ready    TOPIC: mittens* + sasha*
  nassim&gt; .join                                TOPIC: mittens* + sasha* | nassim
 mittens&gt; .at preprod                          TOPIC: &lt;preprod&gt; mittens + sasha | nassim
 mittens&gt; .good                                TOPIC: &lt;preprod&gt; mittens* + sasha | nassim
   sasha&gt; .good                                TOPIC: &lt;preprod&gt; mittens* + sasha* | nassim
 pushbot&gt; mittens, sasha: Everyone is ready    TOPIC: &lt;preprod&gt; mittens* + sasha* | nassim
 mittens&gt; .at prod                             TOPIC: &lt;prod&gt; mittens + sasha | nassim
 mittens&gt; .good                                TOPIC: &lt;prod&gt; mittens* + sasha | nassim
     asm&gt; .join                                TOPIC: &lt;prod&gt; mittens* + sasha | nassim + asm
   sasha&gt; .good                                TOPIC: &lt;prod&gt; mittens* + sasha* | nassim + asm
     asm&gt; .nm                                  TOPIC: &lt;prod&gt; mittens* + sasha* | nassim
 pushbot&gt; mittens, sasha: Everyone is ready    TOPIC: &lt;prod&gt; mittens* + sasha* | nassim
 mittens&gt; .done                                TOPIC: nassim
 pushbot&gt; nassim: You're up                    TOPIC: nassim
    lily&gt; .join                                TOPIC: nassim | lily</pre>
<p>This strategy has been successful for a lot of reasons, but especially because each deploy is handled by the people most familiar with the changes that are shipping. Those that wrote the code are in the best position to recognize it breaking, and then fix it. Because of that, developers should be empowered to deploy code as needed, and remain close to its rollout.</p>
<p>App releases are a different beast. They don’t easily adapt to that philosophy of deploying code. For one, they have versions and need to be compiled. And since they’re distributed via app stores, those versions can take time to reach end users. Traditionally, these traits have led to strategies involving release branches and release managers. Our app releases started out this way, but we learned quickly that they didn’t feel very Etsy. And so we set out to change them.</p>
<h2><a style="text-decoration: none;color: black;border-bottom: none" href="https://codeascraft.com/wp-content/uploads/2017/05/poop.png">Jen</a> and Sasha</h2>
<p class="alignnone"><a href="https://codeascraft.com/wp-content/uploads/2017/05/3-Jen-and-sasha-release-management.jpeg" rel="attachment wp-att-4905"><img class="size-medium wp-image-4905 alignright" src="https://codeascraft.com/wp-content/uploads/2017/05/3-Jen-and-sasha-release-management-300x183.jpeg" alt="photo of Sasha Friedenberg and Jen Macchiarelli" width="300" height="183" srcset="https://codeascraft.com/wp-content/uploads/2017/05/3-Jen-and-sasha-release-management-300x183.jpeg 300w, https://codeascraft.com/wp-content/uploads/2017/05/3-Jen-and-sasha-release-management-768x468.jpeg 768w, https://codeascraft.com/wp-content/uploads/2017/05/3-Jen-and-sasha-release-management.jpeg 853w" sizes="(max-width: 300px) 100vw, 300px" /></a>We were the release managers. Jen managed the <a href="https://play.google.com/store/apps/details?id=com.etsy.android.soe&amp;hl=en">Sell on Etsy</a> apps, and I managed the <a href="https://itunes.apple.com/us/app/etsy-shop-handmade-vintage-creative-goods/id477128284?mt=8">Etsy</a> apps. We were responsible for all release stage transitions, maintaining the schedule, and managing all the communications around releases. We were also responsible for resolving conflicts and coordinating cross-team resources in cases of bugs and urgent blockers to release.</p>
<h3>Ready to Ship</h3>
<p>A key part of our job was making sure everyone knew what they’re supposed to do and when they’re supposed to do it. The biggest such checkpoint is when a release branches — this is when we create a dedicated branch for the release off master, and master becomes the next release. This is scheduled and determines what changes make it into production for a given release. It’s very important to make sure that those changes are expected, and that they have been tested.</p>
<p>For <a href="https://twitter.com/jenmacchiarelli">Jen</a> and me, it would’ve been impossible to keep track of the many changes in a release ourselves, and so it was our job to coordinate with the engineers that made the actual changes and make sure those changes were expected and tested. In practice, this meant sending emails or messaging folks when approaching certain checkpoints like branching. And likewise, if there were any storm warnings (such as show-stopping bugs), it was our responsibility to raise the flag to notify others.</p>
<p class="alignnone"><a href="https://codeascraft.com/wp-content/uploads/2017/05/4-List-of-Release-Manager-Responsibilities.png"><img class="wp-image-4906 size-medium alignright" src="https://codeascraft.com/wp-content/uploads/2017/05/4-List-of-Release-Manager-Responsibilities-300x168.png" alt="list of words indicating various responsibilities for release managers" width="300" height="168" srcset="https://codeascraft.com/wp-content/uploads/2017/05/4-List-of-Release-Manager-Responsibilities-300x168.png 300w, https://codeascraft.com/wp-content/uploads/2017/05/4-List-of-Release-Manager-Responsibilities.png 768w" sizes="(max-width: 300px) 100vw, 300px" /></a>Then Jen left Etsy for another opportunity, and I became a single-point-of-failure and a gatekeeper. Every release decision was funneled through me, and I was the only person able to make and execute those decisions.</p>
<p>I was overwhelmed. Frustrated. I was worried I’d be stuck navigating iTunes Connect and Google Play, and sending emails. And frankly, I didn’t want to be doing those things. I wanted those things to be automated. Give me a button to upload to iTunes Connect, and another to begin staged rollout on Google Play. Thinking about the ease of deploying on web just filled me with envy.</p>
<p>This time wasn’t easy for engineers either. Even back when we had two release managers, from an engineer’s perspective, this period of app releases wasn’t transparent. It was difficult to know what phase of release we were in. A large number of emails was sent, but few of them were targeted to those that actually needed them. We would generically send emails to one big list that included all four of our apps. And all kinds of emails would get sent there. Things that were FYI-only, and also things that required urgent attention. We were on the path to <a href="http://www.kitchensoap.com/2013/07/22/owning-attention-considerations-for-alert-design">alert-fatigue</a>.</p>
<p>All of this meant that engineers felt more like they were in the cargo hold, rather than in the cockpit. But that just didn’t fit with how we do things for web. It didn’t fit with our philosophy for deployment. We didn’t like it. We wanted something better, something that placed engineers in front of the tiller.</p>
<h2>Ship</h2>
<p><a href="https://codeascraft.com/2017/05/15/how-etsy-ships-apps/5-ship-index/" rel="attachment wp-att-4899"><img class="aligncenter wp-image-4899 size-full" src="https://codeascraft.com/wp-content/uploads/2017/05/5-Ship-Index.png" alt="screenshot showing Etsy's Ship's main page" width="1011" height="450" srcset="https://codeascraft.com/wp-content/uploads/2017/05/5-Ship-Index.png 1011w, https://codeascraft.com/wp-content/uploads/2017/05/5-Ship-Index-300x134.png 300w, https://codeascraft.com/wp-content/uploads/2017/05/5-Ship-Index-768x342.png 768w" sizes="(max-width: 1011px) 100vw, 1011px" /></a></p>
<p>So we built a vessel that coordinates the status, schedule, communications, and deploy tools for app releases. Here’s how Ship helps:</p>
<ul>
<li>Keeps track of who committed changes to a release</li>
<li>Sends Slack messages and emails to the right people about the relevant events</li>
<li>Manages the state and schedule of all releases</li>
</ul>
<p>It’s hard to imagine all of that abstractly, so here’s an example:</p>
<h3>Captain’s Log</h3>
<ul>
<li>Alicia makes her first commit to the iOS app for v4.64.0.</li>
<li>Ship gets notified of this and sends Alicia <a href="https://codeascraft.com/wp-content/uploads/2017/05/6-Onboarding-email.png">an email welcoming her to v4.64.0</a>.</li>
</ul>
<h4>Monday</h4>
<ul>
<li>A cron moves the release into &#8220;Testing&#8221; and generates testing build v4.64.0.52.</li>
<li>Ship is notified of this and sends <a href="https://codeascraft.com/wp-content/uploads/2017/05/7-Please-Test-Email.png">an email to Alicia with the build</a>.</li>
<li>Alicia installs the build, verifies her changes, and tells Ship she’s ready.</li>
</ul>
<h4>Tuesday</h4>
<ul>
<li>Everyone has tested their changes and <a href="https://codeascraft.com/wp-content/uploads/2017/05/9-Everyone-is-Ready-Ship-screenshot.png">reported themselves as ready</a>.</li>
<li>A cron branches the release and creates a release candidate.</li>
<li>Ship is notified and <a href="https://codeascraft.com/wp-content/uploads/2017/05/10-final-testing-email-1.png">sends an email to coordinate final testing of the release</a>.</li>
</ul>
<h4>Wednesday</h4>
<ul>
<li>The final testing finds no show-stopping issues</li>
<li>A cron submits v4.64.0 to iTunes Connect for review.</li>
</ul>
<h4>Friday</h4>
<ul>
<li>A cron checks iTunes Connect for the review status of this release, and updates Ship that it’s been approved.</li>
<li>Ship emails Alicia and others letting them know the release is approved.</li>
</ul>
<h4>Tuesday</h4>
<ul>
<li>A cron releases v4.64.0.<br />
(Had Alicia committed to our Android app, a cron would instead begin staged rollout on Google Play.)</li>
<li>Ship emails Alicia and others letting them know the release is out in production.</li>
</ul>
<h4>Wednesday</h4>
<ul>
<li>Ship emails a report of top crashes to all the engineers in the release (including Alicia)</li>
</ul>
<p>Before Ship, all of these components above would’ve been performed manually. But you’ll notice that release managers are missing from the above script; have we replaced release managers with all the automations in Ship?</p>
<p><a href="https://www.etsy.com/listing/220021401/international-code-flag-letter-g-fathers" rel="attachment wp-att-4915"><img class="aligncenter wp-image-4915 size-medium" src="https://codeascraft.com/wp-content/uploads/2017/05/13-Listing-I-Require-a-Pilot-248x300.jpg" alt="photo of Etsy listing featuring a flag used by nautical ships to communicate: the flag says &quot;I require a pilot&quot;" width="248" height="300" srcset="https://codeascraft.com/wp-content/uploads/2017/05/13-Listing-I-Require-a-Pilot-248x300.jpg 248w, https://codeascraft.com/wp-content/uploads/2017/05/13-Listing-I-Require-a-Pilot.jpg 497w" sizes="(max-width: 248px) 100vw, 248px" /></a></p>
<h3>Release Drivers</h3>
<p>Partially. Ship has a feature where each release is assigned a driver.</p>
<p><a href="https://codeascraft.com/2017/05/15/how-etsy-ships-apps/14-driver-section/" rel="attachment wp-att-4907"><img class="aligncenter size-full wp-image-4907" src="https://codeascraft.com/wp-content/uploads/2017/05/14-Driver-Section.png" alt="screenshot showing Etsy's Ship's driver section. The driver in this case is Hannah Mittelstaedt" width="535" height="147" srcset="https://codeascraft.com/wp-content/uploads/2017/05/14-Driver-Section.png 535w, https://codeascraft.com/wp-content/uploads/2017/05/14-Driver-Section-300x82.png 300w" sizes="(max-width: 535px) 100vw, 535px" /></a></p>
<p>This driver is responsible for a bunch of things that we couldn’t or <a href="https://www.ise.ncsu.edu/wp-content/uploads/2017/02/Bainbridge_1983_Automatica.pdf">shouldn’t automate</a>. Here’s what they’re responsible for:</p>
<ul>
<li>Schedule changes</li>
<li>Shepherding ‘ready to ships’ from other engineers</li>
<li>Investigating showstopping bugs before release</li>
</ul>
<p>Everything else? That’s automated. Branching, release candidate generation, submission to iTunes Connect — even staged rollout on Google Play! But, we’ve learned from <a href="https://codeascraft.com/wp-content/uploads/2017/05/GIF-FANTASIA-BROOM2.gif">automation</a> <a href="https://codeascraft.com/wp-content/uploads/2017/05/brooms-on-parade.gif">going awry</a> before. By default, some things are set to manual. There are others for which Ship explicitly does not allow automation, such as continuing staged rollout on Google Play. Things like this should involve and require human interaction. For everything else that is automated, we added a failsafe: at any time, a driver can disable all the crons and take over driving from autopilot:</p>
<p><a href="https://codeascraft.com/2017/05/15/how-etsy-ships-apps/15-automated-ship-actions/" rel="attachment wp-att-4908"><img class="aligncenter size-full wp-image-4908" src="https://codeascraft.com/wp-content/uploads/2017/05/15-Automated-Ship-Actions.png" alt="screenshot of Etsy's Ship showing the various automation options that can be set on a per-releases basis." width="496" height="220" srcset="https://codeascraft.com/wp-content/uploads/2017/05/15-Automated-Ship-Actions.png 496w, https://codeascraft.com/wp-content/uploads/2017/05/15-Automated-Ship-Actions-300x133.png 300w" sizes="(max-width: 496px) 100vw, 496px" /></a></p>
<p>When a driver wants to do something manually, they don’t need access to iTunes Connect or Google Play, as each of these things is made accessible as a button. A really nice side effect of this is that we don’t have to worry about provisioning folks for either app store, and we have a clear log of every release-related action taken by drivers.</p>
<p>Drivers are assigned once a release moves onto master, and are semi-randomly selected based on previous drivers and engineers that have committed to previous releases. Once assigned, we send them an onboarding email letting them know what their responsibilities are:</p>
<p><a href="https://codeascraft.com/2017/05/15/how-etsy-ships-apps/16-driver-onboarding-email/" rel="attachment wp-att-4904"><img class="aligncenter size-full wp-image-4904" src="https://codeascraft.com/wp-content/uploads/2017/05/16-Driver-Onboarding-Email.png" alt="screenshot of Etsy's Ship's driver onboarding email" width="602" height="365" srcset="https://codeascraft.com/wp-content/uploads/2017/05/16-Driver-Onboarding-Email.png 602w, https://codeascraft.com/wp-content/uploads/2017/05/16-Driver-Onboarding-Email-300x182.png 300w" sizes="(max-width: 602px) 100vw, 602px" /></a></p>
<h3>Ready to Ship Again</h3>
<p>The driver can remain mostly dormant until the day of branching. A couple hours before we branch, it’s the driver’s responsibility to make sure that all the impacting engineers are ready to ship, and to orchestrate efforts when they’re not. After we’re ready, the driver’s responsibility is to remain available as a point-of-contact while final testing takes place. If an issue comes up, the driver may be consulted for steps to resolve.</p>
<p>And then, assuming all goes well, comes release day. The driver can opt to manually release, or let the cron do this for them — they’ll get notified if something goes wrong, either way. Then a day after we release, the driver looks at all of our dashboards, logs, and graphs to confirm the health of the release.</p>
<h3>Bugfixes</h3>
<p>But not all releases are planned. Things fail, and that’s <a href="https://codeascraft.com/wp-content/uploads/2017/05/GIF-SORCERER-MICKEY-BOOK.gif">expected</a>. It’s naïve to assume some serious bug won’t ship with an app release. There’s plenty of things that can and will be the subject of a <a href="https://codeascraft.com/2012/05/22/blameless-postmortems/">post-mortem</a>. When one of those things happens, any engineer can spawn a bugfix release off the most-recently-released mainline release.</p>
<p><a href="https://codeascraft.com/2017/05/15/how-etsy-ships-apps/17-bugfixes-mainline/" rel="attachment wp-att-4918"><img class="aligncenter wp-image-4918 size-full" src="https://codeascraft.com/wp-content/uploads/2017/05/17-Bugfixes-Mainline.png" alt="diagram showing how a bugfix branch comes off of an existing release branch and not master" width="674" height="380" srcset="https://codeascraft.com/wp-content/uploads/2017/05/17-Bugfixes-Mainline.png 674w, https://codeascraft.com/wp-content/uploads/2017/05/17-Bugfixes-Mainline-300x169.png 300w" sizes="(max-width: 674px) 100vw, 674px" /></a></p>
<p>The engineer that requests this bugfix gets assigned as the driver for that release. Once they branch the release, they make the necessary bugfixes (others can join in to add bugfixes too, if they coordinate with the driver) in the release’s branch, build a release candidate, test it, and get it ready for production. The driver can then release it at will.</p>
<h2>State Machine</h2>
<p>Releases are actually quite complicated.</p>
<p><a href="https://codeascraft.com/2017/05/15/how-etsy-ships-apps/18-ship-state-machine/" rel="attachment wp-att-4919"><img class="aligncenter size-full wp-image-4919" src="https://codeascraft.com/wp-content/uploads/2017/05/18-Ship-State-Machine.png" alt="diagram indicating the state machine that powers Etsy's Ship" width="932" height="1131" srcset="https://codeascraft.com/wp-content/uploads/2017/05/18-Ship-State-Machine.png 932w, https://codeascraft.com/wp-content/uploads/2017/05/18-Ship-State-Machine-247x300.png 247w, https://codeascraft.com/wp-content/uploads/2017/05/18-Ship-State-Machine-768x932.png 768w, https://codeascraft.com/wp-content/uploads/2017/05/18-Ship-State-Machine-844x1024.png 844w" sizes="(max-width: 932px) 100vw, 932px" /></a></p>
<p>It starts off as an abstract thing that will occur in the future. Then becomes a concrete thing actively collecting changes via commits on master in git. After this period of collecting commits, the release is considered complete and moves into its own dedicated branch. The release candidate is then built from this dedicated branch, which then gets thoroughly tested, and moved into production. The release itself then concludes as an unmerged branch.</p>
<p>Once a release branches, the next future release moves onto master. Each release is its own state machine, where the development and branching states overlap between successive releases.</p>
<h3>Notifications: Slack and Email</h3>
<p><a href="https://codeascraft.com/2017/05/15/how-etsy-ships-apps/slack_-_etsy_2017-05-10_11-28-16/" rel="attachment wp-att-4920"><img class="aligncenter size-full wp-image-4920" src="https://codeascraft.com/wp-content/uploads/2017/05/Slack_-_Etsy_2017-05-10_11-28-16.png" alt="screenshot showing a notification sent via Slack" width="848" height="139" srcset="https://codeascraft.com/wp-content/uploads/2017/05/Slack_-_Etsy_2017-05-10_11-28-16.png 848w, https://codeascraft.com/wp-content/uploads/2017/05/Slack_-_Etsy_2017-05-10_11-28-16-300x49.png 300w, https://codeascraft.com/wp-content/uploads/2017/05/Slack_-_Etsy_2017-05-10_11-28-16-768x126.png 768w" sizes="(max-width: 848px) 100vw, 848px" /></a></p>
<p>Plugged into the output of Ship are notifications. Because there are so many points of interest en route to production, it’s really important that the right people are notified at the right times. So we use the state machine of Ship to send out notifications to engineers (and other subscribers) based on how much they asked to know, and how they impacted the release. We also allow anyone to sign up for notifications around a release. This is used by product managers, designers, support teams, engineering managers, and more. Our communications are very targeted to those that need or want them.</p>
<p>In terms of what they asked to know, we made it very simple to get detailed emails about state changes to a release:</p>
<p><a href="https://codeascraft.com/2017/05/15/how-etsy-ships-apps/20-subscription-options/" rel="attachment wp-att-4909"><img class="aligncenter size-full wp-image-4909" src="https://codeascraft.com/wp-content/uploads/2017/05/20-Subscription-Options.png" alt="screenshot of Etsy's Ship showing the subscription options for engineers and non-engineers on a per-release basis" width="610" height="492" srcset="https://codeascraft.com/wp-content/uploads/2017/05/20-Subscription-Options.png 610w, https://codeascraft.com/wp-content/uploads/2017/05/20-Subscription-Options-300x242.png 300w" sizes="(max-width: 610px) 100vw, 610px" /></a></p>
<p>In terms of how they impacted the release, we need to get that data from somewhere else.</p>
<h2>Git</h2>
<p>We mentioned data Ship receives from outside sources. At Etsy, we use GitHub for our source control. Our apps have repos per-platform (Android and iOS). In order to keep Ship’s knowledge of releases up-to-date, we set up <a href="https://developer.github.com/webhooks/">GitHub Webhooks</a> to notify Ship whenever changes are pushed to the repo. We listen for two changes in particular: pushes to master, and pushes to any release branch.</p>
<p>When Ship gets notified, it iterates through the commits and uses the author, changed paths, and commit message to determine which app (buyer or seller) the commit affects, and which release we should attribute this change to. Ship then takes all of that and combines it into a state that represents every engineer’s impact on a given release. Is that engineer &#8220;user-impacting&#8221; or &#8220;dark&#8221; (<a href="https://codeascraft.com/2011/02/04/how-does-etsy-manage-development-and-operations/">our term for changes that aren’t live</a>)? Ship then uses this state to determine who is a member of what release, and who should get notified about what events.</p>
<p>Additionally, at any point during a release, an engineer can change their status. They may want to do this if they want to receive more information about a release, or if Ship misunderstood one of their commits as being impacting to the release.</p>
<h2>Deployinator</h2>
<p>Everything up until has explained how Ship keeps track of things. But there’s been no explanation for how some of the automated actions affecting the app repo or things outside Etsy occur.</p>
<p>We <a href="https://codeascraft.com/2010/05/20/quantum-of-deployment/">have a home-grown tool for managing deploys called Deployinator</a>, and we added app support. It can now perform mutating interactions with the app repos, as well as all the deploy actions related to Google Play and iTunes Connect. This is where we build the testing candidates, release candidate, branch the release, submit to iTunes Connect, and much more.</p>
<p>We opted to use Deployinator for a number of reasons:</p>
<ul>
<li>Etsy engineers are already familiar with it</li>
<li>It’s our go-to environment for wrapping up a build process into a button</li>
<li>Good for things that need individual run logs, and clear failures</li>
</ul>
<p>In our custom stack, we have crons. This is how we branch on Tuesday evening (assuming everyone is ready). This is where we interface with Google Play and iTunes Connect. We make use of Google Play’s official API in a custom python module we wrote, and for iTunes Connect we use <a href="https://github.com/fastlane/fastlane/tree/master/spaceship">Spaceship</a> to interface with the unofficial API.</p>
<h2>Seaworthy</h2>
<p>The end result of Ship is that we’ve distributed release management. Etsy no longer has any dedicated release managers. But it does have an engineer who used to be one — and I even get to drive a release every now and then.</p>
<p>People cannot be fully automated away. That applies to our web deploys, and is equally true for app releases. Our new process works within that reality. It’s unique because it pushes the limit of what we thought could be automated. Yet, at the same time, it empowers our app engineers more than ever before. Engineers control when a release goes to prod. Engineers decide if we’re ready to branch. Engineers hit the buttons.</p>
<p>And that’s what Ship is really about. It empowers our engineers to deliver the best apps for our users. Ship puts engineers at the helm.</p>
]]></content>
		<link rel="replies" type="text/html" href="https://codeascraft.com/2017/05/15/how-etsy-ships-apps/#comments"
			  thr:count="6"/>
		<link rel="replies" type="application/atom+xml"
			  href="https://codeascraft.com/2017/05/15/how-etsy-ships-apps/feed/atom/" thr:count="6"/>
		<thr:total>6</thr:total>
	</entry>
	<entry>
		<author>
			<name>Mohit Nayyar</name>
		</author>
		<title type="html"><![CDATA[Modeling Spelling Correction for Search at Etsy]]></title>
		<link rel="alternate" type="text/html"
			  href="https://codeascraft.com/2017/05/01/modeling-spelling-correction-for-search-at-etsy/"/>
		<id>https://codeascraft.com/?p=4876</id>
		<updated>2017-05-02T16:24:06Z</updated>
		<published>2017-05-01T15:59:21Z</published>
		<category scheme="https://codeascraft.com" term="data"/>
		<category scheme="https://codeascraft.com" term="search"/>
		<category scheme="https://codeascraft.com" term="data science"/>
		<summary type="html">
			<![CDATA[Introduction When a user searches for an item on Etsy, they don&#8217;t always type what they mean. Sometimes they type the query jewlery when they&#8217;re looking for jewelry; sometimes they just accidentally hit an extra key and type dresss instead of dress. To make their online shopping experience successful, we need to identify and fix [&#8230;]]]></summary>
		<content type="html"
				 xml:base="https://codeascraft.com/2017/05/01/modeling-spelling-correction-for-search-at-etsy/">
			<![CDATA[<h2>Introduction</h2>
<p><span style="font-weight: 400">When a user searches for an item on Etsy, they don&#8217;t always type what they mean. Sometimes they type the query </span><i><span style="font-weight: 400">jewlery</span></i><span style="font-weight: 400"> when they&#8217;re looking for </span><i><span style="font-weight: 400">jewelry</span></i><span style="font-weight: 400">; sometimes they just accidentally hit an extra key and type </span><i><span style="font-weight: 400">dresss</span></i><span style="font-weight: 400"> instead of </span><i><span style="font-weight: 400">dress</span></i><span style="font-weight: 400">. To make their online shopping experience successful, we need to identify and fix these mistakes, and display search results for the canonical spelling of the actual intended query. With this motivation in mind, and </span><span style="font-weight: 400">through the efforts of the Data Science, Linguistic Tools, and the Search Infrastructure teams, we overhauled the way we do spelling correction at Etsy late last year.</span></p>
<p><span style="font-weight: 400">The older service was based on a static mapping of misspelled words to their respective corrections, which was updated only infrequently. It would split a search query into its tokens, and replace any token that was identified as a misspelling with its correction. Although the service allowed a very fast way of retrieving a correction, it was not an ideal solution for a few reasons:</span></p>
<ol>
<li style="font-weight: 400"><span style="font-weight: 400">It could only correct misspellings that had already been identified and added to the map; it would leave previously unseen misspellings uncorrected.</span></li>
<li style="font-weight: 400"><span style="font-weight: 400">There was no systematic process in place to update the misspelling-correction pairs in the map.</span></li>
<li style="font-weight: 400"><span style="font-weight: 400">There was no mechanism of inferring the word from the context of surrounding words. For instance, if someone intended to type</span><i><span style="font-weight: 400"> butter dish</span></i><span style="font-weight: 400">, but instead typed </span><i><span style="font-weight: 400">buttor dish</span></i><span style="font-weight: 400">, the older system would correct that to </span><i><span style="font-weight: 400">button dish</span></i><span style="font-weight: 400"> since </span><i><span style="font-weight: 400">buttor</span></i><span style="font-weight: 400"> is a more commonly observed misspelling for button at Etsy.</span></li>
<li style="font-weight: 400"><span style="font-weight: 400">Additionally, the older system would not allow one-to-many mappings from misspellings to corrections. Storing both </span><i><span style="font-weight: 400">buttor</span></i><span style="font-weight: 400"> -&gt;  </span><i><span style="font-weight: 400">button</span></i><span style="font-weight: 400"> and </span><i><span style="font-weight: 400">buttor</span></i><span style="font-weight: 400"> -&gt; </span><i><span style="font-weight: 400">butter</span></i><span style="font-weight: 400"> mappings simultaneously would not be possible without modifying the underlying data structure.</span></li>
</ol>
<p><span style="font-weight: 400">We, therefore, decided to upgrade the spelling correction service to one based on a statistical model. This model learns from historical user data on Etsy’s website and uses the context of surrounding words to offer the most probable correction.</span></p>
<p>Although this blog post outlines some aspects of the infrastructure components of the service, its main focus is on describing the statistical model used by it.</p>
<h2>Model</h2>
<p><span style="font-weight: 400">We use a model that is based upon the </span><a href="https://en.wikipedia.org/wiki/Noisy_channel_model"><span style="font-weight: 400">Noisy Channel Model</span></a><span style="font-weight: 400">, which was historically used to infer telegraph messages that got distorted over the line. In the context of a user typing an incorrectly spelled word on Etsy, the “distortion” could be from accidental typos or a result of the user not knowing the correct spelling. In terms of probabilities, our goal is to determine the probability of the correct word, conditional on the word typed by the user. That probability, as per Bayes’ rule, is proportional to the product of two probabilities:</span></p>
<p><a href="https://codeascraft.com/wp-content/uploads/2017/04/eq1-2.png"><img class="wp-image-4881 aligncenter" src="https://codeascraft.com/wp-content/uploads/2017/04/eq1-2.png" alt="" width="694" height="29" srcset="https://codeascraft.com/wp-content/uploads/2017/04/eq1-2.png 5584w, https://codeascraft.com/wp-content/uploads/2017/04/eq1-2-300x12.png 300w, https://codeascraft.com/wp-content/uploads/2017/04/eq1-2-768x32.png 768w, https://codeascraft.com/wp-content/uploads/2017/04/eq1-2-1024x42.png 1024w" sizes="(max-width: 694px) 100vw, 694px" /></a></p>
<p>We are able to estimate the probabilities on the right-hand side of the relation above, using historical searches performed by our users. We describe this in more detail below.</p>
<p><span style="font-weight: 400">To extend this idea to multi-word phrases, we use a simple</span><a href="https://en.wikipedia.org/wiki/Hidden_Markov_model"><span style="font-weight: 400"> Hidden Markov Model</span></a><span style="font-weight: 400"> (HMM) which determines the most probable sequence of tokens to suggest as a spelling correction. </span><i><span style="font-weight: 400">Markov</span></i><span style="font-weight: 400"> refers to being able to predict the future state of the system based solely on its present state. </span><i><span style="font-weight: 400">Hidden</span></i><span style="font-weight: 400"> refers to the system having hidden states that we are trying to discover. In our case, the hidden states are the correct spellings of the words the user actually typed.</span></p>
<p><span style="font-weight: 400">The main components of an HMM are explained via the figure below. Assume, for the purpose of this post, that the user searched for </span><i><span style="font-weight: 400">Flower Girl Baske </span></i><span style="font-weight: 400">when they intended to search for </span><i><span style="font-weight: 400">Flower Girl Basket</span></i><span style="font-weight: 400">. The main components of an HMM are then as follows:</span></p>
<ol>
<li style="font-weight: 400"><b>Observed states</b><span style="font-weight: 400">: the words explicitly typed by the user, </span><i><span style="font-weight: 400">Flower Girl Baske</span></i><span style="font-weight: 400"> (represented as circles).</span></li>
<li style="font-weight: 400"><b>Hidden states</b><span style="font-weight: 400">: the correct spellings of the words the user intended to type, </span><i><span style="font-weight: 400">Flower Girl Basket</span></i><span style="font-weight: 400"> (represented as squares).</span></li>
<li style="font-weight: 400"><b>Emission probability</b><span style="font-weight: 400">: the conditional probability of observing a state given the hidden state.</span></li>
<li style="font-weight: 400"><b>Transition probability</b><span style="font-weight: 400">: the probability of observing a state conditional upon the probability of the immediately previous observed state, like, for instance, in the figure below, the probability of transitioning from </span><i><span style="font-weight: 400">Girl</span></i><span style="font-weight: 400"> to </span><i><span style="font-weight: 400">Baske</span></i><span style="font-weight: 400">, i.e., </span><i><span style="font-weight: 400">P(Baske|Girl)</span></i><span style="font-weight: 400">. The fact that this probability does not depend on the probability of having observed </span><i><span style="font-weight: 400">Flower</span></i><span style="font-weight: 400">, the state that precedes </span><i><span style="font-weight: 400">Girl,</span></i><span style="font-weight: 400"> illustrates the Markov property of the model.</span></li>
</ol>
<p><a href="https://codeascraft.com/wp-content/uploads/2017/04/HMM.png"><img class="size-full wp-image-4882 aligncenter" src="https://codeascraft.com/wp-content/uploads/2017/04/HMM.png" alt="" width="600" height="480" srcset="https://codeascraft.com/wp-content/uploads/2017/04/HMM.png 600w, https://codeascraft.com/wp-content/uploads/2017/04/HMM-300x240.png 300w" sizes="(max-width: 600px) 100vw, 600px" /></a></p>
<p><span style="font-weight: 400">Once the spelling correction service receives the query, it first splits the query into three tokens, and then suggests possible corrections for each of the tokens as shown in the figure below.</span></p>
<p><a href="https://codeascraft.com/wp-content/uploads/2017/04/motivating-example-1.png"><img class="wp-image-4883 aligncenter" src="https://codeascraft.com/wp-content/uploads/2017/04/motivating-example-1.png" alt="" width="702" height="741" srcset="https://codeascraft.com/wp-content/uploads/2017/04/motivating-example-1.png 1350w, https://codeascraft.com/wp-content/uploads/2017/04/motivating-example-1-284x300.png 284w, https://codeascraft.com/wp-content/uploads/2017/04/motivating-example-1-768x811.png 768w, https://codeascraft.com/wp-content/uploads/2017/04/motivating-example-1-970x1024.png 970w" sizes="(max-width: 702px) 100vw, 702px" /></a></p>
<p><span style="font-weight: 400">In each column, one of the correction possibilities represents the true hidden state of the token that was typed (emitted) by the user. The most probable sequence can be thought of as identifying the true hidden state for each token given the context of the previous token. To accomplish this, we need to know probabilities from two distributions: first, the probability of typing a misspelling given the correct spelling of the word, the emission probability, and, second, the probability of transitioning from one observed word to another, the transition probability.</span></p>
<p><span style="font-weight: 400">Once we are able to calculate all the emission probabilities, and the transition probabilities needed, as described in the sections below, we can determine the most probable sequence using a common dynamic programming algorithm known as the </span><a href="https://en.wikipedia.org/wiki/Viterbi_algorithm"><span style="font-weight: 400">Viterbi Algorithm</span></a><span style="font-weight: 400">.</span></p>
<h4><span style="font-weight: 400">Error Model</span></h4>
<p><span style="font-weight: 400">The emission probability is estimated through an Error Model, which is a statistical model created by inferring historical corrections provided by our own users while making searches on Etsy. The heuristic we used is based on two conditions: a user’s search being followed immediately by another search similar to the first, and with the second search then leading to a listing click. We align these tokens to each other in a way that minimizes the number of edits needed on the misspelled query to transform it into the corrected second query.</span></p>
<p><span style="font-weight: 400">We then make aligned splits on the characters, </span><span style="font-weight: 400">and calculate counts and associated conditional probabilities</span><span style="font-weight: 400">. We generate character level probabilities for four types of operations: substitution, insertion, deletion, and transposition. Of these, insertion and deletion also require us to also keep track of the context of neighboring letters &#8212; the probability of adding a letter after another, or removing a letter appearing after another, respectively.</span></p>
<p><span style="font-weight: 400">To continue with the earlier example, when the user typed </span><i><span style="font-weight: 400">baske</span></i><span style="font-weight: 400">, the emitted token, they were probably trying to type </span><i><span style="font-weight: 400">basket</span></i><span style="font-weight: 400">, the hidden state for </span><i><span style="font-weight: 400">baske,</span></i><span style="font-weight: 400"> which corresponds to</span> <span style="font-weight: 400">the probability </span><i><span style="font-weight: 400">P(Baske|Basket)</span></i><span style="font-weight: 400">. Error probabilities for tokens, such as these, are calculated by multiplying the character-level probabilities which are assumed to be independent. For instance, the probability of correcting the letter </span><i><span style="font-weight: 400">e</span></i><span style="font-weight: 400"> by appending the letter </span><i><span style="font-weight: 400">t</span></i><span style="font-weight: 400"> to it is given by:</span></p>
<p><a href="https://codeascraft.com/wp-content/uploads/2017/04/eqn2.png"><img class="wp-image-4884 aligncenter" src="https://codeascraft.com/wp-content/uploads/2017/04/eqn2.png" alt="" width="345" height="59" srcset="https://codeascraft.com/wp-content/uploads/2017/04/eqn2.png 2837w, https://codeascraft.com/wp-content/uploads/2017/04/eqn2-300x51.png 300w, https://codeascraft.com/wp-content/uploads/2017/04/eqn2-768x130.png 768w, https://codeascraft.com/wp-content/uploads/2017/04/eqn2-1024x174.png 1024w" sizes="(max-width: 345px) 100vw, 345px" /></a></p>
<p><span style="font-weight: 400">Here, the numerator is the number of times in our dataset where we see an </span><i><span style="font-weight: 400">e</span></i><span style="font-weight: 400"> being corrected to an </span><i><span style="font-weight: 400">et</span></i><span style="font-weight: 400">, and the denominator is the number of corrections where any letter was appended after </span><i><span style="font-weight: 400">e</span></i><span style="font-weight: 400">. Since we assume that the probability </span><span style="font-weight: 400">associated with a character remaining unchanged is 1, in our case, the probability </span><i><span style="font-weight: 400">P(Baske|Basket)</span></i><span style="font-weight: 400"> is solely dependent on the insertion probability </span><i><span style="font-weight: 400">P(et|e)</span></i><span style="font-weight: 400">.</span></p>
<h4><span style="font-weight: 400">Language Model</span></h4>
<p><span style="font-weight: 400">Transition probabilities are estimated through a language model which is determined by calculating the unigram and bigram token frequencies seen in our historical search queries.</span></p>
<p><span style="font-weight: 400">A specific instance of that, from the chosen example, would be the probability of going from one token in the </span><i><span style="font-weight: 400">Flower (first)</span></i><span style="font-weight: 400"> column, say </span><i><span style="font-weight: 400">Flow</span></i><span style="font-weight: 400">, to a token, say </span><i><span style="font-weight: 400">Girl</span></i><span style="font-weight: 400">, in the </span><i><span style="font-weight: 400">Girl</span></i><span style="font-weight: 400"> (second) column, which is represented as </span><i><span style="font-weight: 400">P(Girl|Flow)</span></i><span style="font-weight: 400">. We are able to determine that probability from the following ratio of bigram token counts to unigram token counts:</span></p>
<p><a href="https://codeascraft.com/wp-content/uploads/2017/04/eqn3.png"><img class="wp-image-4885 aligncenter" src="https://codeascraft.com/wp-content/uploads/2017/04/eqn3.png" alt="" width="322" height="52" srcset="https://codeascraft.com/wp-content/uploads/2017/04/eqn3.png 2730w, https://codeascraft.com/wp-content/uploads/2017/04/eqn3-300x48.png 300w, https://codeascraft.com/wp-content/uploads/2017/04/eqn3-768x124.png 768w, https://codeascraft.com/wp-content/uploads/2017/04/eqn3-1024x165.png 1024w" sizes="(max-width: 322px) 100vw, 322px" /></a></p>
<p><span style="font-weight: 400">The error models and language models are generated through </span><a href="https://github.com/twitter/scalding"><span style="font-weight: 400">Scalding</span></a><span style="font-weight: 400">-powered jobs that run on our production hadoop cluster.</span></p>
<h4><span style="font-weight: 400">Viterbi Algorithm Heuristic</span></h4>
<p><span style="font-weight: 400">To generate inferences using these models, we employ the </span><a href="https://en.wikipedia.org/wiki/Viterbi_algorithm"><span style="font-weight: 400">Viterbi Algorithm</span></a><span style="font-weight: 400"> to determine the optimal query, i.e., sequence of tokens to serve as a spelling correction. The main idea is to present the most probable sequence as the spelling correction. The iterative process goes, as per the figure above, from the first column of tokens to the last. At the n</span><i><span style="font-weight: 400">th</span></i><span style="font-weight: 400"> iteration, we have the sequence with the maximum probability available from the previous iteration, and we choose the token from the nth column which increases the maximum probability from the previous iteration the most.</span></p>
<p><span style="font-weight: 400">Let’s explain this more concretely by describing the third iteration for our main example: assume that we already have </span><i><span style="font-weight: 400">Flower girl</span></i><span style="font-weight: 400"> as the most probable phrase at the second iteration. Now we pick the token from the third column that corresponds to the maximum of the following transition probability and emission probability products:</span></p>
<p><a href="https://codeascraft.com/wp-content/uploads/2017/04/eqn4.png"><img class="wp-image-4886 aligncenter" src="https://codeascraft.com/wp-content/uploads/2017/04/eqn4.png" alt="" width="315" height="93" srcset="https://codeascraft.com/wp-content/uploads/2017/04/eqn4.png 2646w, https://codeascraft.com/wp-content/uploads/2017/04/eqn4-300x89.png 300w, https://codeascraft.com/wp-content/uploads/2017/04/eqn4-768x227.png 768w, https://codeascraft.com/wp-content/uploads/2017/04/eqn4-1024x303.png 1024w" sizes="(max-width: 315px) 100vw, 315px" /></a></p>
<p><a href="https://codeascraft.com/wp-content/uploads/2017/04/Motivating-example-2.png"><img class="alignnone size-full wp-image-4887" src="https://codeascraft.com/wp-content/uploads/2017/04/Motivating-example-2.png" alt="" width="1763" height="1050" srcset="https://codeascraft.com/wp-content/uploads/2017/04/Motivating-example-2.png 1763w, https://codeascraft.com/wp-content/uploads/2017/04/Motivating-example-2-300x179.png 300w, https://codeascraft.com/wp-content/uploads/2017/04/Motivating-example-2-768x457.png 768w, https://codeascraft.com/wp-content/uploads/2017/04/Motivating-example-2-1024x610.png 1024w" sizes="(max-width: 1763px) 100vw, 1763px" /></a></p>
<p><span style="font-weight: 400">We can see from the figure above that the transition probability from </span><i><span style="font-weight: 400">Girl</span></i><span style="font-weight: 400"> to </span><i><span style="font-weight: 400">Basket</span></i><span style="font-weight: 400"> is high enough to overcome the lower emission probability of someone typing </span><i><span style="font-weight: 400">Baske</span></i><span style="font-weight: 400"> when they mean to type </span><i><span style="font-weight: 400">Basket</span></i><span style="font-weight: 400">, and that, consequently, </span><i><span style="font-weight: 400">Basket</span></i><span style="font-weight: 400"> is the word we want to add to the existing </span><i><span style="font-weight: 400">Flower Girl</span></i><span style="font-weight: 400"> phrase.</span></p>
<p><span style="font-weight: 400">We now know that </span><i><span style="font-weight: 400">Flower Girl Basket</span></i><span style="font-weight: 400"> is the most probable correction as predicted by our models. The decision about whether we suggest this correction to the user, and how we suggest it, is made on the basis of its confidence score. We describe that process a little later in the post.</span></p>
<h2>Hyperparameters and Model Training</h2>
<p>We added a few hyperparameters to the bare bones model we have described so far. They are as follows:</p>
<ol>
<li style="font-weight: 400"><span style="font-weight: 400">We added an exponent to the emission probability because we want the model to have some flexibility in weighting the error model component in relation to the language model component.</span></li>
<li style="font-weight: 400"><span style="font-weight: 400">Our threshold for offering a correction is a linear function of the number of tokens in the query. We, therefore, have a slope and the intercept of the threshold as a pair of hyperparameters.</span></li>
<li style="font-weight: 400"><span style="font-weight: 400">Finally, we also have a parameter corresponding to the probability of words our language model does not know about.</span></li>
</ol>
<p><span style="font-weight: 400">Our training data set consists of two types of examples: the first kind are of the form </span><i><span style="font-weight: 400">misspelling -&gt; correct spelling</span></i><span style="font-weight: 400">, like </span><i><span style="font-weight: 400">jewlery -&gt; jewelry</span></i><span style="font-weight: 400">, </span><span style="font-weight: 400">while the second kind are of the form </span><i><span style="font-weight: 400">correct spelling -&gt; _</span></i><span style="font-weight: 400">, like dress -&gt; _. The second type corresponds to queries that are already correct, and therefore don’t need a correction. This setup enables our model to distinguish between the populations of both correct and incorrect spellings, and to offer corrections for the latter.</span></p>
<p><span style="font-weight: 400">We tune our hyperparameters via 10-fold </span><a href="https://en.wikipedia.org/wiki/Cross-validation_(statistics)"><span style="font-weight: 400">cross-validation</span></a><span style="font-weight: 400"> using a </span><a href="https://en.wikipedia.org/wiki/Hill_climbing"><span style="font-weight: 400">hill-climbing</span></a><span style="font-weight: 400"> algorithm that maximizes the </span><a href="https://en.wikipedia.org/wiki/F1_score"><span style="font-weight: 400">f-score</span></a><span style="font-weight: 400"> on our training data set. The f-score is the </span><a href="https://en.wikipedia.org/wiki/Harmonic_mean"><span style="font-weight: 400">harmonic mean</span></a><span style="font-weight: 400"> of the </span><a href="https://en.wikipedia.org/wiki/Precision_and_recall"><span style="font-weight: 400">precision</span></a><span style="font-weight: 400"> and the </span><a href="https://en.wikipedia.org/wiki/Precision_and_recall"><span style="font-weight: 400">recall</span></a><span style="font-weight: 400">. Precision measures how many of the corrections offered by the system are correct and, for our data set, is defined as:</span></p>
<p><a href="https://codeascraft.com/wp-content/uploads/2017/04/eqn5-2.png"><img class="wp-image-4890 aligncenter" src="https://codeascraft.com/wp-content/uploads/2017/04/eqn5-2.png" alt="" width="320" height="62" srcset="https://codeascraft.com/wp-content/uploads/2017/04/eqn5-2.png 2824w, https://codeascraft.com/wp-content/uploads/2017/04/eqn5-2-300x58.png 300w, https://codeascraft.com/wp-content/uploads/2017/04/eqn5-2-768x149.png 768w, https://codeascraft.com/wp-content/uploads/2017/04/eqn5-2-1024x198.png 1024w" sizes="(max-width: 320px) 100vw, 320px" /></a></p>
<p><span style="font-weight: 400">Recall is a measure of coverage &#8212; it tries to answer the question, “how many of the spelling corrections that we should be offering are we offering?”. It is defined as:</span></p>
<p><a href="https://codeascraft.com/wp-content/uploads/2017/04/eqn5-1.png"><img class="wp-image-4889 aligncenter" src="https://codeascraft.com/wp-content/uploads/2017/04/eqn5-1.png" alt="" width="428" height="65" srcset="https://codeascraft.com/wp-content/uploads/2017/04/eqn5-1.png 3642w, https://codeascraft.com/wp-content/uploads/2017/04/eqn5-1-300x46.png 300w, https://codeascraft.com/wp-content/uploads/2017/04/eqn5-1-768x117.png 768w, https://codeascraft.com/wp-content/uploads/2017/04/eqn5-1-1024x156.png 1024w" sizes="(max-width: 428px) 100vw, 428px" /></a></p>
<p><span style="font-weight: 400">Optimizing on the f-score is allows us to increase coverage of the spelling corrections we offer while keeping the number of invalid corrections offered in check.</span></p>
<h2>Serving the Correction</h2>
<p><span style="font-weight: 400">We serve three types of corrections at Etsy based on the confidence we have in the correction. We use the following odds-ratio as our confidence score:</span></p>
<p><a href="https://codeascraft.com/wp-content/uploads/2017/04/eqn7.png"><img class="wp-image-4891 aligncenter" src="https://codeascraft.com/wp-content/uploads/2017/04/eqn7.png" alt="" width="239" height="53" srcset="https://codeascraft.com/wp-content/uploads/2017/04/eqn7.png 2068w, https://codeascraft.com/wp-content/uploads/2017/04/eqn7-300x67.png 300w, https://codeascraft.com/wp-content/uploads/2017/04/eqn7-768x170.png 768w, https://codeascraft.com/wp-content/uploads/2017/04/eqn7-1024x227.png 1024w" sizes="(max-width: 239px) 100vw, 239px" /></a></p>
<p><span style="font-weight: 400">If the confidence is greater than a certain threshold, we display search results corresponding to the correction, along with a &#8220;Search instead of&#8221; link to see the results for the original query instead. If the confidence is below a certain threshold, we offer results of the original query, with a “Did you mean” option to the suggested correction. If we don’t have any results for the original query, but do have results for the corrected query, we display results for the correction independent of the confidence score.</span></p>
<h2>Spelling Correction Service</h2>
<p><span style="font-weight: 400">With the new service in place, when a search is made on Etsy, we fire off requests to both the new Java-based spelling service and the existing search service. The response from the spelling service includes both the correction and its confidence score, and how we display the correction, based on the confidence score, is described in the previous section. For high-confidence corrections, we make an additional request for search results with the corrected query, and display those results if their count is greater than a certain threshold.</span></p>
<p><span style="font-weight: 400">When the spelling service receives a query, it first splits it into its constituent tokens. It then makes independent suggestions for each of the tokens, and, finally, strings together from those suggestions a sequence of the most probable tokens. This corrected sequence is sent back to the web stack as a response to the spelling service request.</span></p>
<p><span style="font-weight: 400">The correction suggestions for each token are generated by Lucene’s</span><a href="https://lucene.apache.org/core/6_1_0/suggest/org/apache/lucene/search/spell/DirectSpellChecker.html"> <i><span style="font-weight: 400">DirectSpellChecker</span></i></a><span style="font-weight: 400"> class which queries an index generated from tokens that are generated through a Hadoop job. The Hadoop job counts tokens from historical queries, rejecting any tokens that appear too infrequently or those that appear only in search queries with very few search results. We have a daily cron that ships the tokens, along with the generated Error and Language model files, from HDFS to the boxes that host the spelling correction service. A periodic rolling restart of the service across all boxes ensures that the freshest models and index tokens are picked up by the service.</span></p>
<h2><span style="font-weight: 400">Follow-up Work</span></h2>
<p><span style="font-weight: 400">The original implementation of the model was limited, in the sense, that it could not suggest corrections that were, at the token level, more than two edits away from the original token. We have subsequently implemented an auxiliary framework of suggesting correction tokens that fixes this issue.</span></p>
<p><span style="font-weight: 400">Another limitation was related to splitting and compounding of tokens in the original query to make suggestions. For instance, we were not able to suggest </span><i><span style="font-weight: 400">earring</span></i><span style="font-weight: 400"> as a suggestion for </span><i><span style="font-weight: 400">ear ring</span></i><span style="font-weight: 400">. Some of our coworkers are working on modifying the service to accommodate corrections of this type.</span></p>
<p><span style="font-weight: 400">Although we do use supervised learning to train the hyperparameters of our models, since launching the service we have additional inputs from our users which we can improve our models with. Specifically, users clicking the “Did you mean” link on our low-confidence corrections results page provides us with explicit positive feedback, while clicks on the “Search instead for” link on our high-confidence corrections results page provides us with negative feedback. The next major evolution of the model would be to explicitly use this feedback to improve corrections.</span></p>
<p>(This project was a collaboration between Melanie Gin and Benjamin Russell on the Linguistic Tools team who built out the infrastructure and front-end; Caitlin Cellier and Mohit Nayyar on the Data Science team who worked on implementing the statistical model; and Zhi-Da Zhong on the Search Infrastructure team who consulted on infrastructure design. A special thanks to Caitlin whose presentation some of these figures are copied from.)</p>
]]></content>
		<link rel="replies" type="text/html"
			  href="https://codeascraft.com/2017/05/01/modeling-spelling-correction-for-search-at-etsy/#comments"
			  thr:count="2"/>
		<link rel="replies" type="application/atom+xml"
			  href="https://codeascraft.com/2017/05/01/modeling-spelling-correction-for-search-at-etsy/feed/atom/"
			  thr:count="2"/>
		<thr:total>2</thr:total>
	</entry>
	<entry>
		<author>
			<name>Andy Yaco-Mink</name>
		</author>
		<title type="html"><![CDATA[How Etsy Manages HTTPS and SSL Certificates for Custom Domains on Pattern]]></title>
		<link rel="alternate" type="text/html"
			  href="https://codeascraft.com/2017/01/31/how-etsy-manages-https-and-ssl-certificates-for-custom-domains-on-pattern/"/>
		<id>https://codeascraft.com/?p=4819</id>
		<updated>2017-01-31T16:03:39Z</updated>
		<published>2017-01-31T16:03:39Z</published>
		<category scheme="https://codeascraft.com" term="engineering"/>
		<category scheme="https://codeascraft.com" term="infrastructure"/>
		<category scheme="https://codeascraft.com" term="security"/>
		<summary type="html">
			<![CDATA[In April of 2016 Etsy launched Pattern, a new product that gives Etsy sellers the ability to create their own hosted e-commerce website. With an easy-setup experience, modern and stylish themes, and guest checkout, sellers can merchandise and manage their brand identity outside of the Etsy.com retail marketplace while leveraging all of Etsy’s e-commerce tools. [&#8230;]]]></summary>
		<content type="html"
				 xml:base="https://codeascraft.com/2017/01/31/how-etsy-manages-https-and-ssl-certificates-for-custom-domains-on-pattern/">
			<![CDATA[<p>In April of 2016 Etsy launched Pattern, a new product that gives Etsy sellers the ability to create their own hosted e-commerce website. With an easy-setup experience, modern and stylish themes, and guest checkout, sellers can merchandise and manage their brand identity outside of the Etsy.com retail marketplace while leveraging all of Etsy’s e-commerce tools.</p>
<p>The ability to point a custom domain to a Pattern site is an especially popular feature; many Pattern sites use their own domain name, either registered directly on the Pattern dashboard, or linked to Pattern from a third-party registrar.</p>
<p>At launch, Pattern shops with custom domains were served over HTTP, while checkouts and other secure actions happened over secure connections with Etsy.com. This model isn’t ideal though; Google ranks pages with SSL slightly higher, and plans to increase the bump it gives to sites with SSL. That’s a big plus for our sellers. Plus, it’s the year 2017 &#8211; we don’t want to be serving pages over boring old HTTP if we can help it … and we really, really like little green lock icons.</p>
<p><img class="size-medium wp-image-4822 aligncenter" src="https://codeascraft.com/wp-content/uploads/2017/01/1-ezgif.com-e44db92901.gif" alt="Securify that address bar!" width="300" height="29" /></p>
<p>In this post we’ll be looking at some interesting challenges you run into when building a system designed to serve HTTPS traffic for hundreds of thousands of domains.</p>
<h2>How to HTTPS</h2>
<p>First, let’s talk about how HTTPS works, and how we might set it up for a single domain.</p>
<p>Let’s not talk <i>that</i> much about how HTTPS works though, because that would take a long time. Very briefly: by HTTPS we mean HTTP over SSL, and by SSL we mean TLS. All of this is a way for your website to communicate securely with clients. When a client first begins communicating with your site, you provide them with a certificate, and the client verifies that your certificate comes from a trusted certificate authority. (This is a gross over-simplification, here’s a <a href="http://www.moserware.com/2009/06/first-few-milliseconds-of-https.html">very interesting post with more detail</a>.)</p>
<p>Suffice to say, if you want HTTPS, you need a certificate, and if you want a certificate you need to get one from a certificate authority. Until fairly recently, this is the point where you had to open up your wallet. There were <a href="https://w3techs.com/technologies/overview/ssl_certificate/all">a handful of certificate authorities</a>, each with an array of confusing options and pricey up-sells.</p>
<p>&nbsp;</p>
<p><a href="https://codeascraft.com/wp-content/uploads/2017/01/2-Buy__Compare_SSL_Certificates__Symantec__Purchase_EV_Wildcard_and_SAN_SSL_2016-11-13_18-18-58.png"><img class="alignnone size-full wp-image-4823" src="https://codeascraft.com/wp-content/uploads/2017/01/2-Buy__Compare_SSL_Certificates__Symantec__Purchase_EV_Wildcard_and_SAN_SSL_2016-11-13_18-18-58.png" alt="What's the _deal_ with this cert pricing?!" width="901" height="211" srcset="https://codeascraft.com/wp-content/uploads/2017/01/2-Buy__Compare_SSL_Certificates__Symantec__Purchase_EV_Wildcard_and_SAN_SSL_2016-11-13_18-18-58.png 901w, https://codeascraft.com/wp-content/uploads/2017/01/2-Buy__Compare_SSL_Certificates__Symantec__Purchase_EV_Wildcard_and_SAN_SSL_2016-11-13_18-18-58-300x70.png 300w, https://codeascraft.com/wp-content/uploads/2017/01/2-Buy__Compare_SSL_Certificates__Symantec__Purchase_EV_Wildcard_and_SAN_SSL_2016-11-13_18-18-58-768x180.png 768w" sizes="(max-width: 901px) 100vw, 901px" /></a></p>
<p>&nbsp;</p>
<p>You pick whichever feels right to you, you get out your credit card, and you wind up with a certificate that’s valid for one to three years. Some CA’s offer API’s, but three years is a relatively long time, so chances are you do this manually. Plus, who even knows which cell in which SSL pricing matrix gets you API access?</p>
<p>From here, if you’re managing a limited number of domains, typically what you do is upload your certificate and private key to your load balancer (or CDN) and it handles TLS termination for you. Clients communicate with your load balancer over HTTPS using your domain’s public certificate, and your load balancer makes internal requests to your application.</p>
<p>&nbsp;</p>
<p><a href="https://codeascraft.com/wp-content/uploads/2017/01/3-SSL_Blog_Diagrams_2017-01-04_15-40-01.png"><img class="size-full wp-image-4824 aligncenter" src="https://codeascraft.com/wp-content/uploads/2017/01/3-SSL_Blog_Diagrams_2017-01-04_15-40-01.png" alt="3-SSL_Blog_Diagrams_2017-01-04_15-40-01" width="621" height="120" srcset="https://codeascraft.com/wp-content/uploads/2017/01/3-SSL_Blog_Diagrams_2017-01-04_15-40-01.png 621w, https://codeascraft.com/wp-content/uploads/2017/01/3-SSL_Blog_Diagrams_2017-01-04_15-40-01-300x58.png 300w" sizes="(max-width: 621px) 100vw, 621px" /></a></p>
<p>&nbsp;</p>
<p>And that’s it! Your clients have little green padlocks in their address bars, and your application is serving payloads just like it used to.</p>
<h2>More certificates, more problems</h2>
<p>Manually issuing certificates works well enough if your application is served off a handful of top-level domains. If you need certificates for lots and lots of TLDs, it’s not going to work. Have we mentioned that Pattern is available for the very reasonable price of $15 per month? A real baseline requirement for us is we can’t pay more for a certificate than someone pays for a year of Pattern. And we certainly don’t have time to issue all those certificates by hand.</p>
<p>Until fairly recently, our only options at this point would have been 1) do a deal with one of the big certificate authorities that offers API access, or 2) become our own certificate authority. These are both expensive options (we don’t like expensive options).</p>
<h3>Let’s Encrypt to the rescue</h3>
<p>Luckily for us, in April of 2016,  the Internet Security Research Group (ISRG), which includes founders from the Mozilla Foundation and the Electronic Frontier Foundation, launched a new certificate authority named <a href="https://letsencrypt.org/">Let’s Encrypt</a>.</p>
<p>The ISRG has also designed a communication protocol, Automated Certificate Management Environment (ACME), that covers the process of issuing and renewing certificates for TLS termination. Let’s Encrypt provides its service for <i>free</i>, and exclusively via an API that implements the ACME protocol. (You can <a href="https://letsencrypt.org/how-it-works/">read about it in more detail here.</a>)</p>
<p>This is great for our project: we found a certificate authority we feel really good about, and since it implements a freely published protocol, there are great open source libraries out there for interacting with it.</p>
<h3>Building out certificate issuance</h3>
<p>Let’s re-examine our problem now that we have a good way to get certificates:</p>
<ol>
<li>We have a large quantity of custom domains attached to existing Pattern sites; we need to generate certificates for all of those.</li>
<li>We have a constant stream of new domain registrations for new Pattern sites; we’ll need to get new certificates on a rolling basis.</li>
<li>Let’s Encrypt certificates last 90 days; we need to renew our SSL certificates fairly frequently.</li>
</ol>
<p>All of these problems are solvable now! We chose an open source ACME client library for PHP called <a href="https://github.com/acmephp">AcmePHP</a>. Another exciting thing about Let’s Encrypt using an open protocol, there are open source <i>server</i> implementations as well as client implementations. So we were able to spin up an internal equivalent of Let’s Encrypt called <a href="https://github.com/letsencrypt/boulder">boulder</a> and do our development and testing inside our private network, without worrying about rate limits.</p>
<p>&nbsp;</p>
<p><a href="https://codeascraft.com/wp-content/uploads/2017/01/4-SSL_Blog_Diagrams_2017-01-04_15-40-56.png"><img class="size-full wp-image-4825 aligncenter" src="https://codeascraft.com/wp-content/uploads/2017/01/4-SSL_Blog_Diagrams_2017-01-04_15-40-56.png" alt="4-SSL_Blog_Diagrams_2017-01-04_15-40-56" width="502" height="365" srcset="https://codeascraft.com/wp-content/uploads/2017/01/4-SSL_Blog_Diagrams_2017-01-04_15-40-56.png 502w, https://codeascraft.com/wp-content/uploads/2017/01/4-SSL_Blog_Diagrams_2017-01-04_15-40-56-300x218.png 300w" sizes="(max-width: 502px) 100vw, 502px" /></a></p>
<p>&nbsp;</p>
<p>The service we built out to handle this ACME logic, store the certificates we receive, and keep track of which domains we have certificates for we named CertService. It’s a service that deals with certificates, you see. CertService communicates with Let’s Encrypt, and also exposes an API for other internal Etsy services. We’ll go into more detail on that later in this post.</p>
<h2>TLS termination for lots and lots of domains</h2>
<p>Now that we’ve build out a service that can have certificates issued, we need a place to put them, and we need to use them to do TLS termination for HTTPS requests to Pattern custom domains.</p>
<p>We handle this for *.etsy.com by putting our certificates directly onto our load balancers and giving them to our CDN’s. In planning this project, we thought about hundreds of thousands of certificates, each with a 90 day lifetimes. If we did a good job spacing out issuing and renewing our certificates, that would add up to thousands of daily write operations to our load balancers and CDN’s. That’s not a rate we were comfortable with; load balancer and CDN configuration changes are relatively high risk operations.</p>
<p>What we did instead, is create a pool of proxy servers, and use our load balancer to distribute HTTPS traffic to them. The proxy hosts handle the client SSL termination, and proxy internal requests to our web servers, much like the load balancer does for www.etsy.com.</p>
<p>&nbsp;</p>
<p><a href="https://codeascraft.com/wp-content/uploads/2017/01/5-SSL_Blog_Diagrams_2017-01-04_15-44-05.png"><img class="size-full wp-image-4826 aligncenter" src="https://codeascraft.com/wp-content/uploads/2017/01/5-SSL_Blog_Diagrams_2017-01-04_15-44-05.png" alt="5-SSL_Blog_Diagrams_2017-01-04_15-44-05" width="540" height="477" srcset="https://codeascraft.com/wp-content/uploads/2017/01/5-SSL_Blog_Diagrams_2017-01-04_15-44-05.png 540w, https://codeascraft.com/wp-content/uploads/2017/01/5-SSL_Blog_Diagrams_2017-01-04_15-44-05-300x265.png 300w" sizes="(max-width: 540px) 100vw, 540px" /></a></p>
<p>&nbsp;</p>
<p>Our proxy hosts run Apache and we leverage mod_ssl and mod_proxy to do TLS termination and proxy requests. To preserve client IP addresses, we make use of <a href="http://www.haproxy.org/download/1.5/doc/proxy-protocol.txt">the PROXY protocol</a> on our load balancer and mod_proxy_protocol on the proxy hosts. We’re also using mod_macro to avoid ever having to write out hundreds of thousands of virtual hosts declarations for hundreds of thousands of domains. All put together, it looks something like this:</p>
<pre><code class="apacheconf">
ProxyPass               /  https://internal-web-vip/
ProxyPassReverse        /  https://internal-web-vip/

&lt;Macro VHost $domain&gt;
&lt;VirtualHost *:443&gt;
    ProxyProtocol On
    ServerName $domain

    SSLEngine on
    SSLCertificateFile      $domain.crt
    SSLCertificateKeyFile   $domain.key
    SSLCertificateChainFile lets-encrypt-cross-signed.pem
&lt;/VirtualHost&gt;
&lt;/Macro&gt;

Use VHost custom-domain-1.com
...
Use VHost custom-domain-n.com
</code></pre>
<p>To connect all this together, our proxy hosts periodically query CertService for a list of recently modified custom domains. Each host then 1) fetches the new certificates from CertService, 2) writes them to disk, 3) regenerates a config like the one above, and 4) does a graceful restart of Apache. These restarts are staggered across our proxy pool so all but one of the hosts is available and receiving requests from the load balancer at any give time (fingers crossed).</p>
<h2>How do we securely store lots of certificates?</h2>
<p>Now that we’ve figured out how to programmatically request and renew SSL certificates via LetsEncrypt, we need to store these certificates in a secure way. To do this, there are some guarantees we need to make:</p>
<ol>
<li>Private keys are stored in a database segmented from other types of data</li>
<li>Private keys encrypted at rest and never leave CertService in plaintext</li>
<li>SSL key pair generation and LetsEncrypt communications take place only on trusted hosts</li>
<li>Private keys can be retrieved only by the SSL terminating hosts</li>
</ol>
<p>Guarantee #1 is a no-brainer. If an attacker were to compromise a datastore containing thousands of SSL private keys in plaintext, they would be be able to intercept critical data being sent to thousands of custom domains. <span style="font-weight: 400;">Since security is about raising costs for an attacker &#8211; that is, making it harder for an attacker to succeed &#8211; we employ a number of techniques to secure our keys.</span> Our first layer of defense is at an infrastructure level: private keys are stored in a MySQL database away from the rest of the network. We use iptables to limit who can connect to the MySQL server, and given that CertService is the only client that needs access, the scope is really narrow. This vastly reduces attack surface, especially in cases where an attacker is looking to pivot from another compromised server on the network. Iptables is also then used to lock down who can communicate to the CertService API; adding constraints to connectivity on top of a secure authentication scheme makes retrieving certificates that much more difficult. That addresses Guarantee #4.</p>
<p>Now that we’ve locked down access to the database, we need to make sure they’re stored encrypted. For this, we make use of a concept known as a hybrid cryptosystem. Hybrid cryptosystems, in a nutshell, combine asymmetric (public-key crypto) and symmetric cryptosystems. If you’re familiar with SSL, much of how we handle crypto here is analogous to Session Keys.</p>
<p>At the start of this process, we have two pieces of data: the SSL private key and its corresponding public key &#8211; the certificate. We don’t particularly care about the certificate since that is public by definition. We start by generating a domain specific AES-256 key and encrypt the SSL private key. This only technically addresses the issue of not having plaintext on disk; the encrypted SSL private key is stored right next to the AES key, which can be used to both encrypt and decrypt. An attacker who could steal the encrypted keys could also steal the AES key. To address this, we encrypt the AES key with a CertService public key. Now we have an encrypted SSL private key (encrypted with the AES-256 key) and an encrypted AES key (encrypted with CertService’s RSA-2048 public key). Now not only are keys truly stored encrypted on disk, they also cannot be decrypted at all on CertService. This means if an attacker were to break CertService’s authentication scheme, the most they would receive is an encrypted SSL private key; they would still need the CertService private key &#8211; available only on the SSL terminating hosts &#8211; to decrypt it. Now we’ve fully taken care of Guarantee #2.</p>
<p>&nbsp;</p>
<p><a href="https://codeascraft.com/wp-content/uploads/2017/01/6-SSL_Blog_Diagrams_2016-11-28_10-52-25.png"><img class="size-full wp-image-4827 aligncenter" src="https://codeascraft.com/wp-content/uploads/2017/01/6-SSL_Blog_Diagrams_2016-11-28_10-52-25.png" alt="6-SSL_Blog_Diagrams_2016-11-28_10-52-25" width="606" height="540" srcset="https://codeascraft.com/wp-content/uploads/2017/01/6-SSL_Blog_Diagrams_2016-11-28_10-52-25.png 606w, https://codeascraft.com/wp-content/uploads/2017/01/6-SSL_Blog_Diagrams_2016-11-28_10-52-25-300x267.png 300w" sizes="(max-width: 606px) 100vw, 606px" /></a></p>
<p>&nbsp;</p>
<p>The only Guarantee that remains is #3. If key generation were compromised, an attacker would be able to grab private keys before they were encrypted and stored. If LetsEncrypt communication were compromised, an attacker could use our keys to generate certificates for domains we’ve already authorized (they could technically authorize new ones, but that would be significantly more difficult) or even revoke certificates. Both of these cases would render the entire system untrustworthy. Instead, we limit this functionality to CertService and expose it as an API; that way, if the web server handling Pattern requests were broken into, the attacker would not be able to affect critical LetsEncrypt flows.</p>
<p>&nbsp;</p>
<p><a href="https://codeascraft.com/wp-content/uploads/2017/01/7-SSL_Blog_Diagrams_2016-11-23_15-30-55.png"><img class="size-full wp-image-4828 aligncenter" src="https://codeascraft.com/wp-content/uploads/2017/01/7-SSL_Blog_Diagrams_2016-11-23_15-30-55.png" alt="7-SSL_Blog_Diagrams_2016-11-23_15-30-55" width="612" height="308" srcset="https://codeascraft.com/wp-content/uploads/2017/01/7-SSL_Blog_Diagrams_2016-11-23_15-30-55.png 612w, https://codeascraft.com/wp-content/uploads/2017/01/7-SSL_Blog_Diagrams_2016-11-23_15-30-55-300x151.png 300w" sizes="(max-width: 612px) 100vw, 612px" /></a></p>
<p>&nbsp;</p>
<p>One of our stretch goals is to look into deploying <a href="https://en.wikipedia.org/wiki/Hardware_security_module">HSMs</a>. If there are bugs in the underlying software, the integrity of the entire system could be compromised thus voiding any guarantees we try to keep. While bugs are inevitable, moving critical cryptographic functions into secure hardware will mitigate their impact.</p>
<p>No cryptosystem is perfect, but we’ve reached our goal of significantly increasing attacker cost. On top of that, we’ve supplemented the cryptosystem with our usual host based alerting and monitoring. So not only will an attacker have to jump through several hoops to get those SSL key pairs, they will also have to do it without being detected.</p>
<h2>After the build</h2>
<p>With all of that wrapped up, we had a system to issue large numbers of certificates, securely store this data, and terminate TLS requests with it. At this point Etsy brought in a third-party security firm to do a round of penetration testing. This process finished up without finding any substantive security weaknesses, which gives us an added level of confidence in our system.</p>
<p>Once we’ve gained enough confidence, we will enable <a href="https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security">HSTS</a>. This should be the final goal of any SSL rollout as it forces browsers to use encryption for all future communication. Without it, downgrade attacks could be used to intercept traffic and hijack session cookies.</p>
<p>Every Pattern site and linked domain now has a valid certificate stored in our system and ready to facilitate secure requests. This feature is rolled out across Pattern and all Pattern traffic is now pushed over HTTPS!</p>
<p>(This project was a collaboration between Ram Nadella, Andy Yaco-Mink and Nick Steele on the Pattern team; Omar Ahmed and Ken Lee from Security; and Will Gallego from Operations. Big thanks to Dennis Olvany, Keyur Govande and Mike Adler for all their help.)</p>
]]></content>
		<link rel="replies" type="text/html"
			  href="https://codeascraft.com/2017/01/31/how-etsy-manages-https-and-ssl-certificates-for-custom-domains-on-pattern/#comments"
			  thr:count="26"/>
		<link rel="replies" type="application/atom+xml"
			  href="https://codeascraft.com/2017/01/31/how-etsy-manages-https-and-ssl-certificates-for-custom-domains-on-pattern/feed/atom/"
			  thr:count="26"/>
		<thr:total>26</thr:total>
	</entry>
	<entry>
		<author>
			<name>Daniel Marks</name>
		</author>
		<title type="html">
			<![CDATA[Optimizing Meta Descriptions, H1s and Title Tags: Lessons from Multivariate SEO Testing at Etsy]]></title>
		<link rel="alternate" type="text/html"
			  href="https://codeascraft.com/2017/01/25/optimizing-meta-descriptions-h1s-and-title-tags-lessons-from-multivariate-seo-testing-at-etsy/"/>
		<id>https://codeascraft.com/?p=4803</id>
		<updated>2017-01-25T16:21:37Z</updated>
		<published>2017-01-25T14:57:02Z</published>
		<category scheme="https://codeascraft.com" term="Uncategorized"/>
		<category scheme="https://codeascraft.com" term="analytics"/>
		<category scheme="https://codeascraft.com" term="data engineering"/>
		<category scheme="https://codeascraft.com" term="data science"/>
		<category scheme="https://codeascraft.com" term="experimentation"/>
		<category scheme="https://codeascraft.com" term="seo"/>
		<summary type="html">
			<![CDATA[We recently ran a successful split-testing title tag experiment to improve our search engine optimization (SEO), the results and methodology of which we shared in a previous Code as Craft post. In this post, we wanted to share some of our further learnings from our SEO testing. We decided to double down on the success [&#8230;]]]></summary>
		<content type="html"
				 xml:base="https://codeascraft.com/2017/01/25/optimizing-meta-descriptions-h1s-and-title-tags-lessons-from-multivariate-seo-testing-at-etsy/">
			<![CDATA[<p><span style="font-weight: 400">We recently ran a successful split-testing title tag experiment to improve our search engine optimization (SEO), the results and methodology of which we shared in </span><a href="https://codeascraft.com/2016/10/25/seo-title-tag-optimization/"><span style="font-weight: 400">a previous Code as Craft post</span></a><span style="font-weight: 400">. In this post, we wanted to share some of our further learnings from our SEO testing. We decided to double down on the success of our previous experiment by running a series of further SEO experiments, one of which included changes to our:</span></p>
<ul>
<li style="font-weight: 400"><span style="font-weight: 400">Title tags</span></li>
<li style="font-weight: 400"><span style="font-weight: 400">Meta descriptions</span></li>
<li style="font-weight: 400"><span style="font-weight: 400">H1s</span></li>
</ul>
<p><a href="https://codeascraft.com/wp-content/uploads/2017/01/Screen-Shot-2017-01-25-at-10.42.39-AM.png"><img class="alignnone size-large wp-image-4814" src="https://codeascraft.com/wp-content/uploads/2017/01/Screen-Shot-2017-01-25-at-10.42.39-AM-1024x385.png" alt="Screen Shot 2017-01-25 at 10.42.39 AM" width="1024" height="385" srcset="https://codeascraft.com/wp-content/uploads/2017/01/Screen-Shot-2017-01-25-at-10.42.39-AM-1024x385.png 1024w, https://codeascraft.com/wp-content/uploads/2017/01/Screen-Shot-2017-01-25-at-10.42.39-AM-300x113.png 300w, https://codeascraft.com/wp-content/uploads/2017/01/Screen-Shot-2017-01-25-at-10.42.39-AM-768x289.png 768w, https://codeascraft.com/wp-content/uploads/2017/01/Screen-Shot-2017-01-25-at-10.42.39-AM.png 1394w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>We found three surprising results:</p>
<ul>
<li style="font-weight: 400"><span style="font-weight: 400">Shortening our title tags showed improved performance in terms of visits (and other key metrics)</span></li>
<li style="font-weight: 400"><span style="font-weight: 400">Meta descriptions had a statistically significant impact on organic search traffic</span></li>
<li style="font-weight: 400"><span style="font-weight: 400">H1s had a statistically significant impact on organic search traffic</span></li>
</ul>
<h2><strong>Some notes on our methodology</strong></h2>
<p><span style="font-weight: 400">For full details on the setup and methodology of our SEO split testing methodology, please see the previous Code as Craft post referenced above. </span></p>
<p><span style="font-weight: 400">For this particular test, we used six unique treatments and two control groups. The two control groups remained consistent with each other before and after the experiment.</span></p>
<p><a href="https://codeascraft.com/wp-content/uploads/2017/01/control_vs_control_annotated.png"><img class="alignnone size-large wp-image-4813" src="https://codeascraft.com/wp-content/uploads/2017/01/control_vs_control_annotated-1024x889.png" alt="control_vs_control_annotated" width="1024" height="889" srcset="https://codeascraft.com/wp-content/uploads/2017/01/control_vs_control_annotated-1024x889.png 1024w, https://codeascraft.com/wp-content/uploads/2017/01/control_vs_control_annotated-300x260.png 300w, https://codeascraft.com/wp-content/uploads/2017/01/control_vs_control_annotated-768x666.png 768w, https://codeascraft.com/wp-content/uploads/2017/01/control_vs_control_annotated.png 1572w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p><span style="font-weight: 400">To derive the exact estimated causal changes effected in visits, we most often used Causal Impact modeling as implemented in the </span><a href="https://google.github.io/CausalImpact/CausalImpact.html"><span style="font-weight: 400">CausalImpact package by Google</span></a> <span style="font-weight: 400">to standardize the test buckets against the control buckets. In some cases, the </span><a href="https://en.wikipedia.org/wiki/Difference_in_differences"><span style="font-weight: 400">difference in differences method</span></a><span style="font-weight: 400"> was used because it was more reliable in estimating effect sizes when working with strong seasonality swings.</span></p>
<p><span style="font-weight: 400">This experiment was also impacted by strong seasonality and external event effects related to the holidays, sports events and the US elections. The statistical modeling in our final experiment analysis was adjusted for these effects to ensure accurate measurement of the causal effects of the test variants.</span></p>
<h2>Learnings</h2>
<h3><strong>Takeaway #1: Short Title Tags Win Again</strong></h3>
<p><span style="font-weight: 400">The results of this experiment aligned with the findings from our previous SEO title tag experiments, where it appeared shorter title tags drove more visits. We have so far validated our hypothesis that shorter title tags perform better in title tags in multiple separate experiments including many different variations and now feel quite confident that shorter title tags perform better (as measured by organic traffic) </span><b>for Etsy</b><span style="font-weight: 400">. We hypothesize that this effect could be taking place through a number of different causal mechanisms:</span></p>
<ol>
<li><span style="font-weight: 400">  </span><span style="font-weight: 400">Lower </span><a href="https://en.wikipedia.org/wiki/Levenshtein_distance"><span style="font-weight: 400">Levenshtein distance</span></a><span style="font-weight: 400"> and/or higher percentage match to target search queries rewarded by Google&#8217;s search algorithm and thereby improving Etsy&#8217;s rankings in Google search results. Per Wikipedia: “</span><span style="font-weight: 400">the Levenshtein distance between two words is the minimum number of single-character edits (i.e. insertions, deletions or substitutions) required to change one word into the other.”</span></li>
<li><span style="font-weight: 400"> </span><span style="font-weight: 400">Shorter title tags, consisting only of the target search keyword, appear more relevant/enticing to search users</span></li>
</ol>
<h3><strong>Takeaway #2: Meta Descriptions Matter</strong></h3>
<p><span style="font-weight: 400">We found that changes in the meta description of a page can lead to statistically significant changes to visits. It appeared that longer and descriptive meta descriptions performed better and that conversely, shorter, terse meta descriptions performed worse. We hypothesize that longer meta descriptions might perform better via two possible causal mechanisms:</span></p>
<ol>
<li><span style="font-weight: 400">  </span><span style="font-weight: 400">Longer meta descriptions take up more real estate in a search results page, improving CTRs</span></li>
<li><span style="font-weight: 400">  </span><span style="font-weight: 400">Longer meta descriptions give an appearance of more authority or more content, improving CTRs</span></li>
</ol>
<h3><strong>Takeaway #3: H1s matter</strong></h3>
<p><span style="font-weight: 400">We found that an H1 change can have a statistically significant impact on organic search traffic. However, changes in the H1 section of a page appear to interact with changes in title tags in hard to predict ways. For example, in this experiment, a title tag change in a certain variant increased visits. However, when the title tag change was combined with an H1 change, the positive effect of the title tag change was dulled, </span><b>even though an H1 change by itself in a different variant led to slight increases in visits</b><span style="font-weight: 400">. This highlights the importance of SEO testing before rolling out even seemingly minor changes to Etsy pages.</span></p>
<h2><strong>Accounting For Unexpected Events</strong></h2>
<h4><em>The Donald Trump Effect</em></h4>
<p><span style="font-weight: 400">One example of an event we had to control for (among a number of others) was the “Donald Trump effect”. We observed a large bucket skew on November 9 and 10, 2016 in one of our test groups. Upon investigation, it was found that the skew was due to large increases (+2000% to +5180%) in daily visits to pages related to “Donald Trump” the day after the US Presidential elections. Although the spikes in traffic to these pages were short lived, lasting only several days, they nevertheless did have the potential to unduly bias or reduce the statistical significance of the results of our experiment. These pages were therefore removed and controlled for when conducting the causal impact analyses for this experiment.</span></p>
<p><a href="https://codeascraft.com/wp-content/uploads/2017/01/trump_outlier.png"><img class="alignnone wp-image-4811 size-large" src="https://codeascraft.com/wp-content/uploads/2017/01/trump_outlier-1024x781.png" alt="trump_outlier" width="1024" height="781" srcset="https://codeascraft.com/wp-content/uploads/2017/01/trump_outlier-1024x781.png 1024w, https://codeascraft.com/wp-content/uploads/2017/01/trump_outlier-300x229.png 300w, https://codeascraft.com/wp-content/uploads/2017/01/trump_outlier-768x586.png 768w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<h2><strong>Conclusion</strong></h2>
<p><span style="font-weight: 400">Our SEO experiments illustrate the importance of running SEO tests before making changes to a web page and continue to offer surprising results. However, it is important to note that the results of our experiments are only true for Etsy and do not necessarily reflect best practices for sites generally. We would therefore encourage everyone to discover the strategy that works best for their website through rigorous SEO testing. </span></p>
]]></content>
		<link rel="replies" type="text/html"
			  href="https://codeascraft.com/2017/01/25/optimizing-meta-descriptions-h1s-and-title-tags-lessons-from-multivariate-seo-testing-at-etsy/#comments"
			  thr:count="18"/>
		<link rel="replies" type="application/atom+xml"
			  href="https://codeascraft.com/2017/01/25/optimizing-meta-descriptions-h1s-and-title-tags-lessons-from-multivariate-seo-testing-at-etsy/feed/atom/"
			  thr:count="18"/>
		<thr:total>18</thr:total>
	</entry>
	<entry>
		<author>
			<name>John Allspaw</name>
		</author>
		<title type="html"><![CDATA[Etsy&#8217;s Debriefing Facilitation Guide for Blameless Postmortems]]></title>
		<link rel="alternate" type="text/html"
			  href="https://codeascraft.com/2016/11/17/debriefing-facilitation-guide/"/>
		<id>https://codeascraft.com/?p=4769</id>
		<updated>2016-11-18T09:56:10Z</updated>
		<published>2016-11-17T16:10:24Z</published>
		<category scheme="https://codeascraft.com" term="engineering"/>
		<category scheme="https://codeascraft.com" term="people"/>
		<category scheme="https://codeascraft.com" term="philosophy"/>
		<category scheme="https://codeascraft.com" term="Uncategorized"/>
		<category scheme="https://codeascraft.com" term="blameless postmortems"/>
		<category scheme="https://codeascraft.com" term="debriefing facilitation guide"/>
		<category scheme="https://codeascraft.com" term="human error"/>
		<summary type="html">
			<![CDATA[In 2012, I wrote a post for the Code As Craft blog about how we approach learning from accidents and mistakes at Etsy. I wrote about the perspectives and concepts behind what is known (in the world of Systems Safety and Human Factors) as the New View on “human error.” I also wrote about what [&#8230;]]]></summary>
		<content type="html" xml:base="https://codeascraft.com/2016/11/17/debriefing-facilitation-guide/"><![CDATA[<p><span style="font-weight: 400;">In 2012, I wrote a</span><a href="https://codeascraft.com/2012/05/22/blameless-postmortems/"> <span style="font-weight: 400;">post for the Code As Craft blog</span></a><span style="font-weight: 400;"> about how we approach learning from accidents and mistakes at Etsy. I wrote about the perspectives and concepts behind what is known (in the world of Systems Safety and Human Factors) as the </span><i><span style="font-weight: 400;">New View</span></i><span style="font-weight: 400;"> on “human error.” I also wrote about what it means for an organization to take a different approach, philosophically, to learn from accidents, and that Etsy was such an organization.</span></p>
<p><span style="font-weight: 400;">That post’s purpose was to conceptually point in a new direction, and was, necessarily, void of pragmatic guidance, advice, or suggestions on how to </span><i><span style="font-weight: 400;">operationalize</span></i><span style="font-weight: 400;"> this perspective. Since then, we at Etsy have continued to explore and evolve our understanding of what taking this approach means, practically. For many organizations engaged in software engineering, the group “post-mortem”</span> <span style="font-weight: 400;">debriefing meeting (and accompanying documentation) is where the rubber meets the road.</span></p>
<p><span style="font-weight: 400;">Many responded to that original post with a question:</span></p>
<p><span style="font-weight: 400;">“Ok, you’ve convinced me that we have to take a different view on mistakes and accidents. Now: </span><i><span style="font-weight: 400;">how do you do that</span></i><span style="font-weight: 400;">?&#8221;</span></p>
<p><span style="font-weight: 400;">As a first step to answer that question, we’ve developed a new <a href="https://extfiles.etsy.com/DebriefingFacilitationGuide.pdf">Debriefing Facilitation Guide</a> which we are open-sourcing and publishing.</span></p>
<p><span style="font-weight: 400;">We wrote this document for two reasons.</span></p>
<p><span style="font-weight: 400;">The first is to state emphatically that we believe a “post-mortem” debriefing should be considered first and foremost a </span><i><span style="font-weight: 400;">learning</span></i><span style="font-weight: 400;"> opportunity, not a </span><i><span style="font-weight: 400;">fixing</span></i><span style="font-weight: 400;"> one. All too often, when teams get together to discuss an event, they walk into the room with a story they’ve already rationalized about what happened. This urge to point to a “root” cause is seductive &#8212; it allows us to believe that we’ve understood the event well enough, and can move on towards fixing things.</span></p>
<p><span style="font-weight: 400;">We believe this view is insufficient at best, and harmful at worst, and that gathering multiple diverse perspectives provides valuable context, without which you are only creating an illusion of understanding. Systems safety researcher Nancy Leveson, in her excellent book </span><i><span style="font-weight: 400;">Engineering A Safer World</span></i><span style="font-weight: 400;">, has this to say on the topic:</span></p>
<p><span style="font-weight: 400;">&#8220;An accident model should encourage a broad view of accident mechanisms that expands the investigation beyond the proximate events: A narrow focus on operator actions, physical component failures, and technology may lead to ignoring some of the most important factors in terms of preventing future accidents. The whole concept of ‘root cause’ needs to be reconsidered.&#8221;</span></p>
<p><span style="font-weight: 400;">In other words, if we don&#8217;t pay attention to where and how we “look” to understand an event by considering a debriefing a true exploration with open minds, we can easily miss out on truly valuable understanding. How and where we pay attention to this learning opportunity begins with the debriefing facilitator.</span></p>
<p><span style="font-weight: 400;">The second reason is to help develop debriefing facilitation skills in our field. We wanted to provide practical guidance for debriefing facilitators as they think about preparing for, conducting, and navigating a post-event debriefing. We believe that organizational learning can only happen when </span><i><span style="font-weight: 400;">objective</span></i><span style="font-weight: 400;"> data about the event (the type of data that you might put into a template or form) is placed into context with the </span><i><span style="font-weight: 400;">subjective </span></i><span style="font-weight: 400;">data that can only be gleaned by the skillful constructing of dialogue with the multiple, diverse perspectives in the room.</span></p>
<p><b>The Questions Are As Important As The Answers</b></p>
<p><span style="font-weight: 400;">In his book “Pre-Accident Investigations: Better Questions,” Todd Conklin sheds light on the idea that the focus on understanding complex work is not in the answers</span> <span style="font-weight: 400;">we assert, but in the questions we ask:</span></p>
<p><span style="font-weight: 400;">“The skill is not in knowing the right answer. Right answers are pretty easy. The skill is in asking the right question. The question is everything.”</span></p>
<p><span style="font-weight: 400;">What we learn from an event depends on the questions we ask as facilitators, not just the objective data you gather and put into a document. It is very easy to assume that the narrative of an accident can be drawn up from one person’s singular perspective, and that the challenge is what to do about it moving forward.</span></p>
<p><span style="font-weight: 400;">We do not believe that to be true. Here’s a narrative taken from real debriefing notes, generalized for this post:</span></p>
<p><span style="font-weight: 400;">“I don’t know,” the engineer said, when asked what happened. “I just wasn’t paying attention, I guess. This is on me. I’m sorry, everyone.” The outage had lasted only 9 minutes, but to the engineer it felt like a lifetime. The group felt a strange but comforting relief, ready to fill in the incident report with ‘engineer error’ and continue on with their morning work.</span></p>
<p><span style="font-weight: 400;">The facilitator was not ready to call it a ‘closed case.’</span></p>
<p><span style="font-weight: 400;">“Take us back to before you deployed, Phil&#8230;what do you remember? This looks like the change you prepped to deploy…” The facilitator displayed the code diff on the big monitor in the conference room.</span></p>
<p><span style="font-weight: 400;">Phil looked closely to the red and green lines on the screen and replied “Yep, that’s it. I asked Steve and Lisa for a code review, and they both said it looked good.” Steve and Lisa nod their heads, sheepishly.</span></p>
<p><span style="font-weight: 400;">“So after you got the thumbs-up from Steve and Lisa&#8230;what happened next?” the facilitator continued.</span></p>
<p><span style="font-weight: 400;">“Well, I checked it in, like I always do,” Phil replied. “The tests automatically run, so I waited for them to finish.” He paused for a moment. “I looked on the page that shows the test results, like this&#8230;” Phil brought up the page in his browser, on the large screen.</span></p>
<p><span style="font-weight: 400;">“Is that a new dashboard?” Lisa asked from the back of the room.</span></p>
<p><span style="font-weight: 400;">“Yeah, after we upgraded the Jenkins install, we redesigned the default test results page to the previous colors because the new one was hard to read,” replied Sam, the team lead for the automated testing team.</span></p>
<p><span style="font-weight: 400;">“The page says eight tests failed.” Lisa replied. Everyone in the room squinted.</span></p>
<p><span style="font-weight: 400;">“No, it says zero</span> <span style="font-weight: 400;">tests failed, see…?” Phil said, moving closer to the monitor.</span></p>
<p><span style="font-weight: 400;">Phil hit control-+ on his laptop, increasing the size of the text on the screen. “Oh my. I swear that it said zero tests failed when I deployed.”</span></p>
<p><span style="font-weight: 400;">The facilitator looked at the rest of the group in the conference room. “How many folks in the room saw this number as a zero when Phil first put it up on the screen?” Most of the group’s hands went up. Lisa smiled.</span></p>
<p><span style="font-weight: 400;">“It looked like a zero to me too,” the facilitator said.</span></p>
<p><span style="font-weight: 400;">“Huh. I think because this small font puts slashes in its zeros and it’s in italics, an eight looks a lot like a zero,” Sam said, taking notes. “We should change that.”</span></p>
<p><span style="font-weight: 400;">As a facilitator, it would be easy to stop asking questions at the </span><i><span style="font-weight: 400;">mea culpa </span></i><span style="font-weight: 400;">given by Phil. Without asking him to describe how he </span><i><span style="font-weight: 400;">normally</span></i><span style="font-weight: 400;"> does his work, by bringing us back to what he was doing at the time, what he was focused on, what led him to believe that deploying was going to happen without issue, we might never have considered that the automated test results page could use some design changes to make the number of failed tests clearer, visually.</span></p>
<p><span style="font-weight: 400;">In another case, an outage involved a very complicated set of non-obvious interactions between multiple components. During the debriefing, the facilitator asked each of the engineers who designed the systems and were familiar with the architecture to draw on a whiteboard the picture that they had in their minds when they think about how it all is expected to work.</span></p>
<p><span style="font-weight: 400;">When seen together, each of the diagrams from the different engineers painted a fuller picture of how the components worked together than if there was only one engineer attempting to draw out a &#8220;comprehensive&#8221; and &#8220;canonical&#8221; diagram.</span></p>
<p><span style="font-weight: 400;">The process of drawing this diagram together also brought the engineers to say aloud what they were and were not sure about, and that enabled others in the room to repair those uncertainties and misunderstandings.</span></p>
<p><span style="font-weight: 400;">Both of these cases support the perspective we take at Etsy, which is that debriefings can (and should!) serve multiple purposes, not just a simplistic hunt for remediation items.</span></p>
<p><span style="font-weight: 400;">By placing the focus explicitly on learning first, a well-run debriefing has the potential to educate the organization on not just what didn&#8217;t work well on the day of the event in question, but a whole lot more.</span></p>
<p><span style="font-weight: 400;">The key, then, to having well-run debriefings is to start treating facilitation as a skill in which to invest time and effort.</span></p>
<p><b>Influencing the Industry</b></p>
<p><span style="font-weight: 400;">We believe that publishing this guide will help other organizations think about the way that they train and nurture the skill of debriefing facilitation. Moreover, we also hope that it can continue the greater dialogue in the industry about learning from accidents in software-rich environments.</span></p>
<p><span style="font-weight: 400;">In 2014, knowing how critical I believe this topic to be, someone alerted me to the United States Digital Service Play Books repo on Github, and an </span><a href="https://github.com/usds/playbook/issues/55#issuecomment-55273974"><span style="font-weight: 400;">issue opened about incident review and post-mortems</span></a><span style="font-weight: 400;">. I commented there that this was relevant to our interests at Etsy, and that at some point I would reach back out with work we’ve done in this area.</span></p>
<p><span style="font-weight: 400;">It took two years, but now we’re following up and hoping to reopen the dialogue.</span></p>
<p><span style="font-weight: 400;">Our Debriefing Facilitation Guide repo is <a href="https://github.com/etsy/DebriefingFacilitationGuide">here</a></span><span style="font-weight: 400;">, and we hope that it is useful for other organizations.</span></p>
]]></content>
		<link rel="replies" type="text/html"
			  href="https://codeascraft.com/2016/11/17/debriefing-facilitation-guide/#comments" thr:count="14"/>
		<link rel="replies" type="application/atom+xml"
			  href="https://codeascraft.com/2016/11/17/debriefing-facilitation-guide/feed/atom/" thr:count="14"/>
		<thr:total>14</thr:total>
	</entry>
	<entry>
		<author>
			<name>Jason Shen</name>
		</author>
		<title type="html">
			<![CDATA[How Etsy Uses Code &#8220;Slush&#8221; to Manage Development During the Holidays]]></title>
		<link rel="alternate" type="text/html" href="https://codeascraft.com/2016/11/16/code-slush-holidays/"/>
		<id>https://codeascraft.com/?p=4740</id>
		<updated>2016-11-16T17:14:58Z</updated>
		<published>2016-11-16T13:00:13Z</published>
		<category scheme="https://codeascraft.com" term="operations"/>
		<category scheme="https://codeascraft.com" term="philosophy"/>
		<category scheme="https://codeascraft.com" term="culture"/>
		<category scheme="https://codeascraft.com" term="holidays"/>
		<category scheme="https://codeascraft.com" term="safety"/>
		<category scheme="https://codeascraft.com" term="slush"/>
		<summary type="html">
			<![CDATA[Note: This article was adapted from an internal Etsy newsletter earlier this year. As the holidays roll around, it seemed like a timely opportunity to share what we do with a larger audience. As the calendar year draws to a close, people’s thoughts often turn to fun activities like spending time with family and friends and [&#8230;]]]></summary>
		<content type="html" xml:base="https://codeascraft.com/2016/11/16/code-slush-holidays/"><![CDATA[<p><em>Note: This article was adapted from an internal Etsy newsletter earlier this year. As the holidays roll around, it seemed like a timely opportunity to share what we do with a larger audience.</em></p>
<p>As the calendar year draws to a close, people’s thoughts often turn to fun activities like spending time with family and friends and enjoying pumpkin or peppermint flavored treats. But for retailers, the holiday season is an intense and critically important period for the business.</p>
<p>The months of November and December compose nearly <a href="https://nrf.com/sites/default/files/Documents/NRF%202014%20Holiday%20Survival%20Kit%20REV.pdf">a fifth of all US retail sales</a> and pretty much every retailer needs to undertake special measures during the holidays, from big sales promotions to stocking up on popular items, to hiring additional staff to stock inventory and reduce wait times at checkout.</p>
<p>A lot of these measures apply as well to digital retailers, with the added risk of the entire site running slowly or not at all. In 2015, Neiman Marcus experienced an extended outage on Black Friday and Target and PayPal <a href="http://www.cnbc.com/2015/11/30/cyber-monday-why-retailers-cant-keep-their-sites-from-crashing.html">were intermittently down</a> on Cyber Monday.</p>
<p><span style="font-weight: 400">Etsy is no stranger to this holiday intensity. This is the biggest shopping season of the year for us and we typically receive more site visits than at other times, which translate into more orders. Over the years, our product, engineering, and member-facing organizations have developed practices and approaches to support our community during the intensity of the holidays.</span></p>
<h2>How Etsy Handles the Holidays</h2>
<p>The increase in site traffic and transactions impacts many areas of the business. Inbound support emails and Non-Delivery Cases reach a peak in December, and the Trust and Safety team ramps down outside project work and hiring efforts to focus on providing exceptional support.</p>
<p>“Emotions tend to be more heightened around the holidays” says Corinne Haxton Pavlovic, head of the trust and safety team at Etsy, “There&#8217;s a lot on the line for everyone this time of year &#8211; highs can feel higher and lows can feel lower. We have to really dig into our EQ and make sure that we&#8217;re staying neutral and empathetic.”</p>
<p>For our sellers, the holidays can be an exciting but scary time: “the Etsy sales equivalent of Laird Hamilton surfing a 70-ft wave off Oahu’s North Shore” says Joseph Stanek, seller account manager. Stanek works with a portfolio of top Etsy sellers to advise and support their business growth. He’s found that many sellers spend an enormous amount of effort on holiday sales promotion, and are then hit with a record number of orders. They’re pushed to increase their shipping and fulfillment capabilities, which can serve “as a kind of graduation” as they level up to a new tier of business.</p>
<p>With huge numbers of buyers browsing for the perfect gift, and sellers working hard to manage orders, it’s critically important for Etsy’s platform to be as clear and reliable as possible. That’s why the period between mid-October through December 31st is a time to be exceptionally careful and more conservative than usual about how we make changes to the site. We affectionately refer to this period as “Slush.”</p>
<h2>The Origins of Slush</h2>
<p>The actual term “Slush” is a play on the phrase “code freeze,” which is when a piece of software is deemed finished and thus no new changes are being made to the code base. “Code freezes help to ensure that the system will continue to operate without disruptions,” <a href="https://ctoinsights.wordpress.com/2013/09/29/do-you-need-a-code-freeze/">says Robert Tekiela at CTO Insights</a>. It’s a way to prevent new bugs from being created and and are “commonly used in the retail industry during holiday shopping season when systems load is at a peak.”</p>
<p>Since at Etsy, we still push code during the holidays, just more carefully, it’s not a true code freeze, but a cold, melty mixture of water and ice. Hence, Slush.</p>
<p>According to Jason Wong, Slush at Etsy got started sometime after current CEO Chad Dickerson became CTO in the fall of 2008. As an engineering director of infrastructure, Jason has been a key part of Etsy’s platform stability since joining in 2010. <span style="font-weight: 400">Back then, Etsy’s infrastructure was less robust and the team was still figuring out how to effectively support the already high levels of traffic on Etsy.com. There was not yet a process for managing code deployments during the holidays and the site experienced more crashes than it does today. </span>.</p>
<p>Said Wong, “the question was: during the holiday season, a high traffic, high visibility time when we made a significant portion of our [gross merchandise sales], how do we stabilize the site? That’s where Slush got started.”</p>
<p>Here’s the slightly redacted email from Chad <span style="font-weight: 400">that kicked off the idea </span>of Slush.</p>
<blockquote><p><span style="font-weight: 400">From: </span><b>Chad Dickerson</b></p>
<p><span style="font-weight: 400">Date: Fri, Oct 31, 2008 at 4:08 PM</span></p>
<p><span style="font-weight: 400">Subject: holiday &#8220;slush&#8221; (i.e. freeze) &#8212; need your input</span></p>
<p><span style="font-weight: 400">To: adminName and adminName</span></p>
<p><span style="font-weight: 400">Cc: adminName, adminName, and adminName</span></p>
<p><span style="font-weight: 400">adminName / adminName,</span></p>
<p><span style="font-weight: 400">adminName, adminName, and I met recently to discuss a holiday &#8220;freeze&#8221; beginning at end of day on November 14.  We&#8217;re calling it a &#8220;slush&#8221; because there are certain types of projects that we can still do without making critical changes to the database or introducing bugs.  The goal with setting this freeze is to eliminate the distractions of any projects not on the must-do list so we can focus on the most important projects exclusively. </span></p>
<p><span style="font-weight: 400">adminName, adminName, adminName, and I met earlier this week to mutually agree on what projects we need to complete before the freeze/slush beginning at the end of the day on 11/14.   We came up with a list of &#8220;must do&#8221; projects that need to get done by 11/14, and &#8220;nice to have&#8221; projects if we complete the must-dos:</span></p>
<p><span style="font-weight: 400">[ Link to Document Detailing Slush Plan ]</span></p>
<p><span style="font-weight: 400">There are couple of projects that we&#8217;ve discussed already on the list, like Super Etsy Mini and BuyHandmade blog.  I wanted to make sure that any &#8220;must do&#8221; projects in your worlds are reflected and prioritized.  On Monday, we&#8217;re going to start doing daily standups at 11:30am to track progress against the agreed-upon list of projects leading up to 11/14.   Since there will be 9.5 working days to execute, we need to freeze the list itself by Monday.  Can you review the list and let us know if you have additions that we are missing that we should discuss?  Thanks. </span></p>
<p><span style="font-weight: 400">Chad</span></p></blockquote>
<h2>Learning to Build Safely</h2>
<p>In the early days, Slush was far more strict, in part because Etsy’s infrastructure was not as robust and mature as it is today. We operated off of a federated database model, which in theory was meant to prevent one database crash from affecting another, but in practice, it was hard to keep clusters from affecting one another and site stability suffered as a result. This technical approach also made it hard to understand what went wrong and how the team could fix it.</p>
<p>Engineers went from deploying five times a day to once a day. Feature flags were tested thoroughly so that major features like convos or add to cart could be turned off without shutting down the site.</p>
<p>Over the past few years, a major effort was made to get Etsy’s one really big box called master onto a sharded database model. With a sharded system, data is distributed across a series of smaller active-active pairs so that if single database goes down, there is an exact replica with the data intact. This system is faster, more scalable, and resilient compared to the prior method of simply storing all the data in one really big box. In 2016, we successfully migrated all of our key databases, including receipts, transactions, and many others, “to the shards” and decommissioned the old master database.</p>
<p>Developing continuous deployment was also a major feat which allowed Etsy to develop A/B testing and feature flagging. These technical efforts, in conjunction with our culture of examining failures through blameless postmortems, have allowed allowed Etsy to get better at building safely. Today our engineering staff and systems are studied by organizations around the world.</p>
<h2>Slush Today and Tomorrow</h2>
<p>Within the engineering organization, there’s often a senior staff member who helps organize Slush. The role is an informal one, meant to share best practices and encourage the product org to be mindful of the higher stakes of the holidays. Tim Falzone, an engineering manager on Infrastructure, took on this role in 2015 and presented a few slides at the September Engineering All-Hands which highlight the way we handle Slush today.</p>
<p><a href="https://codeascraft.com/wp-content/uploads/2016/11/September-2015-Engineering-All-Hands-Slush.png"><img class="alignnone wp-image-4760" src="https://codeascraft.com/wp-content/uploads/2016/11/September-2015-Engineering-All-Hands-Slush-300x174.png" alt="september-2015-engineering-all-hands-slush" width="630" height="366" srcset="https://codeascraft.com/wp-content/uploads/2016/11/September-2015-Engineering-All-Hands-Slush-300x174.png 300w, https://codeascraft.com/wp-content/uploads/2016/11/September-2015-Engineering-All-Hands-Slush-768x446.png 768w, https://codeascraft.com/wp-content/uploads/2016/11/September-2015-Engineering-All-Hands-Slush.png 800w" sizes="(max-width: 630px) 100vw, 630px" /></a></p>
<p>Today, Slush means that major buyer and seller facing feature changes are put on hold, or pushed “dark,” where they are hidden behind config flags and not shown publicly. Additionally, engineers get more people to review their pull requests of code changes. These extra precautions are taken to ensure that the site runs quickly and with minimal errors or downtime even with the increased traffic.</p>
<p>Falzone says that now, Slush is less about not breaking the site and more about preventing disruptions for members. “You could easily make something that works flawlessly but tanks conversion or otherwise sends buyers away, or is really slow,” he explained. For sellers, managing a huge wave of orders means relying on muscle memory of how Etsy works, which means that the holidays is a bad time to change the workflow or otherwise add friction for our sellers, who often become profitable on their business for the year during this time.</p>
<p>As Etsy grows, Slush will continue to evolve. A more powerful platform also means more points of integration. More traffic means more pressure on parts of the platform.</p>
<p>Even as we work to secure more headroom for our infrastructure and develop tooling to stress-test our systems, we will always be challenged in new ways. Though we’ve come a long way, Slush will continue to be a helpful reminder to move safely during a critical time of the year for our members and our organization.</p>
]]></content>
		<link rel="replies" type="text/html" href="https://codeascraft.com/2016/11/16/code-slush-holidays/#comments"
			  thr:count="0"/>
		<link rel="replies" type="application/atom+xml"
			  href="https://codeascraft.com/2016/11/16/code-slush-holidays/feed/atom/" thr:count="0"/>
		<thr:total>0</thr:total>
	</entry>
	<entry>
		<author>
			<name>Stefanie Schirmer</name>
		</author>
		<title type="html">
			<![CDATA[API First Transformation at Etsy &#8211; Human aspects &#038; developer adoption]]></title>
		<link rel="alternate" type="text/html"
			  href="https://codeascraft.com/2016/11/08/api-first-transformation-human-aspects-developer-adoption/"/>
		<id>https://codeascraft.com/?p=4754</id>
		<updated>2016-11-08T18:12:55Z</updated>
		<published>2016-11-08T15:52:02Z</published>
		<category scheme="https://codeascraft.com" term="Uncategorized"/>
		<summary type="html">
			<![CDATA[This is the third post in a series of three about Etsy’s API, the abstract interface to our logic and data.In the last posts we covered how we built a new API framework, and we clearly identified the gains in terms of performance and shared abstraction layer between languages and devices. But how did we [&#8230;]]]></summary>
		<content type="html"
				 xml:base="https://codeascraft.com/2016/11/08/api-first-transformation-human-aspects-developer-adoption/">
			<![CDATA[<p><b></b><span style="font-weight: 400;">This is the third post in a <a href="https://codeascraft.com/author/sschirmer/">series of three</a> about Etsy’s API, the abstract interface to our logic and data.</span>In the last posts we covered how we built a new API framework, and we clearly identified the gains in terms of performance and shared abstraction layer between languages and devices. But how did we make an entire engineering organization switch to the new framework?</p>
<p><span style="font-weight: 400;">How did we achieve the cultural transformation to API first? How do we avoid this being the new thing that everyone knows about, but no one has the time to try?</span></p>
<p><a href="https://codeascraft.com/wp-content/uploads/2016/11/adoption.png"><img class="alignnone size-large wp-image-4755" src="https://codeascraft.com/wp-content/uploads/2016/11/adoption-1024x576.png" alt="adoption" width="1024" height="576" srcset="https://codeascraft.com/wp-content/uploads/2016/11/adoption-1024x576.png 1024w, https://codeascraft.com/wp-content/uploads/2016/11/adoption-300x169.png 300w, https://codeascraft.com/wp-content/uploads/2016/11/adoption-768x432.png 768w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<h2></h2>
<h2><b>How did we “sell” it?</b></h2>
<p><span style="font-weight: 400;">In our case, we had multiple strategies that worked together. </span></p>
<p><span style="font-weight: 400;">The first one was </span><b>communication: </b><span style="font-weight: 400;">It was simple to write new endpoints, and the gains were very clear: Both the performance gain through concurrent data fetch, and the possibility to share an endpoint with the apps, were huge selling points.</span></p>
<p><span style="font-weight: 400;">We partnered with the Product organisation to make clear that they needed to include a standard question in their project templates &#8220;Is this being built on APIv3? If not, why not?&#8221;, which enforced the company strategy to adopt Mobile First development.</span></p>
<p><span style="font-weight: 400;">We had </span><b>pilot groups</b><span style="font-weight: 400;"> that tried out the new API framework for new product features, </span><span style="font-weight: 400;">we partnered closely with the Activity Feed team to help them adopt APIv3. This resulted in early converts that were strong advocates for wider adoption. The benefits were clear to communicate but also so compelling that we didn&#8217;t need to do much to sell teams, they could see what the activity feed had accomplished.</span></p>
<p><span style="font-weight: 400;">We had </span><b>evolving documentation</b><span style="font-weight: 400;"> about the architecture and how to use the framework, in the API handbook. We had a codelab, which engineers could use for self study. In the lab you learn to build endpoints by building a little library app.</span></p>
<p><span style="font-weight: 400;">We had workshops in which people did the code lab together with experienced API developers.</span></p>
<p><span style="font-weight: 400;">We had </span><b>tooling</b><span style="font-weight: 400;"> to learn about the system, such as the distributed tracing tool CrossStitch, the fanout manager informing about the complexity of the fetch, and datafindr for general information about API endpoints and example calls and results.</span></p>
<h2><b>Once it&#8217;s going, too fast to keep up</b></h2>
<p><span style="font-weight: 400;">After the word was spreading, so many people were making new endpoints that it was almost impossible for us to keep up with it. Initially, we alerted on each new endpoint, but had to switch this off due to the rate at which new endpoints were being built.</span></p>
<p><span style="font-weight: 400;">The biggest motivator for adoption was that we communicated the gains. Everyone became interested in the performance gains and the cross-device-sharing through abstraction, which was a motivating incentive to switch. Also, there was a potential speedup through caching of endpoints.</span></p>
<h2><b>White space gets filled with code</b></h2>
<p><span style="font-weight: 400;">Immediately after adoption started, we saw some misunderstandings in the code that we did not foresee. Such as magic hiding in traits, inheritance between endpoints, while they contain just declarative static functions, or really complex code in bespoke endpoints, which should be library code. The minimalist code required to write an endpoint didn’t make explicit what is missing by accidental omission vs. deliberate design decisions.</span></p>
<p><span style="font-weight: 400;">This also lead to confusion about which building blocks of endpoints are mandatory, about how to opt into a service, naming conventions, the location in the file system, and the complete route of an endpoint.</span></p>
<p><span style="font-weight: 400;">This was a caused some cleanup work for the API team, but in fact it was a good thing, caused by fast and wide adoption of a new system, and is probably inevitable in that case.</span></p>
<h2><b>Documentation is critical</b></h2>
<p><span style="font-weight: 400;">We addressed the problems by improving our documentation, and creating an interactive endpoint generator that creates a file in the right place, with stub functions, and outputs the route.</span></p>
<p><span style="font-weight: 400;">Also, we added format checks for endpoints in Jenkins. It was helpful to have the API code lab as a narrative introduction to gain practical experience fast, while also developing the API handbook as a reference manual. Two goals, two documents.</span></p>
<p><span style="font-weight: 400;"><a href="https://codeascraft.com/wp-content/uploads/2016/11/Screen-Shot-2016-11-07-at-16.54.35.png"><img class="alignnone size-large wp-image-4756" src="https://codeascraft.com/wp-content/uploads/2016/11/Screen-Shot-2016-11-07-at-16.54.35-1024x576.png" alt="screen-shot-2016-11-07-at-16-54-35" width="1024" height="576" srcset="https://codeascraft.com/wp-content/uploads/2016/11/Screen-Shot-2016-11-07-at-16.54.35-1024x576.png 1024w, https://codeascraft.com/wp-content/uploads/2016/11/Screen-Shot-2016-11-07-at-16.54.35-300x169.png 300w, https://codeascraft.com/wp-content/uploads/2016/11/Screen-Shot-2016-11-07-at-16.54.35-768x432.png 768w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></span></p>
<h2><b>Pockets of Patterns</b></h2>
<p><span style="font-weight: 400;">When we internally announced the project in which we unified the format for how an API endpoint is written, we started getting emails about what developers wanted from the API. And also: Mails about patterns that had emerged within the API framework without our knowledge. People had found and implemented solutions for their specific use cases. Our discussions had opened up a space to evaluate those patterns, and share them with all API endpoint developers!</span></p>
<p><span style="font-weight: 400;">We’ve learned that we need to stay on top of new patterns as they emerge, and keep talking to developers about their needs. A subtle, but powerful paradigm shift:</span></p>
<p><span style="font-weight: 400;">We, as the API framework developers, listen to endpoint developers and address everyone’s needs by evolving the framework. Instead of having developers using our API framework as a service, we are serving them.</span></p>
<p><span style="font-weight: 400;">Also, we learned to trust our fellow developers even more! We underestimated their curiosity and willingness to try out new things, we underestimated the adoption rate, and we also underestimated how creative they would be with finding solutions for their specific use cases that we did not plan for. What an awesome surprise. <img src="https://s.w.org/images/core/emoji/2.2.1/72x72/1f600.png" alt="😀" class="wp-smiley" style="height: 1em; max-height: 1em;" /></span></p>
<p>&nbsp;</p>
<h2><b>Types too late + types too loose D:</b></h2>
<p><span style="font-weight: 400;">Also, we underestimated everyone’s willingness to do the work of typing their endpoint result. In the beginning, we made specifying a resultType optional, because we feared making it mandatory would slow the adoption. And if a type was specified, we only sampled the type errors, to not make correct typing a hurdle during API endpoint development, but rather a “nice to have” hint for when things go wrong. Not a guarantee. In retrospect, we could have saved ourselves a lot of extra work if we had made the resultType mandatory, and if we had made the type errors more prominent from the beginning.</span></p>
<p><span style="font-weight: 400;">Etsy’s developers are generally happy about result types, they helped to implement a coarse grained gradual typing, and actively pushed us towards making the result types mandatory, to rely on them as a guarantee.</span></p>
<h2><b>Work in progress</b></h2>
<p><span style="font-weight: 400;">There remain four open problems we all touched upon:</span></p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Versioning for the Apps &#8211; we got off the hook for JavaScript &amp; PHP, but not the rest</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Active Cache Invalidation &#8211; it&#8217;s hard.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Caching the API at different geographic locations (Edge)</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">opening up v3 to 3rd party developers</span></li>
</ul>
<p><span style="font-weight: 400;">A question that comes with the developer adoption question is: What are we thinking in terms of preparing for third parties? This is a valid question, and we did not fully answer it yet, because we switched to generated client code in the meantime. </span></p>
<p><span style="font-weight: 400;">Even though we started announcing the new API v3 on our developer mailing lists, all third party apps are still on version 2. The platform for v3 is ready to open up to 3rd parties, as soon as Etsy as a whole decides to make the switch.</span></p>
<p><b>What did we learn? How were we transformed?</b></p>
<p><span style="font-weight: 400;">This story is a case study of how the API first approach transformed the architecture, and also transformed how we work with and think about our API at Etsy. It covers a lot of ground and is influenced by our infrastructure and history. The story of architectural decisions and adoption is transferable to other systems though. So what did we learn from the decisions? Or from the decisions not being made yet? Were there surprises?</span></p>
<p><span style="font-weight: 400;">We learned that we can seamlessly grow a system from a hack day project to a live system. Over time, a domain specific language of endpoints evolved, and the system grew according to the endpoint developers needs.</span></p>
<p><span style="font-weight: 400;">Also, we learned a great deal about cURL or the according php extension! Not only does it allow to make parallel requests, but it also let’s us check on, control and modify the in-flight requests in a non-blocking way.</span></p>
<p><span style="font-weight: 400;">Another realization is that we should have thought about caching early on. We added it in a hurry and are still working on active cache invalidation. So far, we can only use timeouts, which limits the class of endpoints that can be cached. Also, we have to think some more about variations due to different locales, which might only vary for parts of the response.</span></p>
<p><span style="font-weight: 400;">A huge positive surprise was the HHVM experiment. By teeing traffic and trying out a completely new system, we solved our performance problems to this day.</span></p>
<p><span style="font-weight: 400;">The textbook approach says: design APIs contract first. As we have seen, we circumvent that part by using automated client generation. Components help us with abstraction, but even the bespoke layer is </span><i><span style="font-weight: 400;">very</span></i><span style="font-weight: 400;"> malleable. This is an interesting trick.</span></p>
<p><span style="font-weight: 400;">Another surprising learning is that we should trust our developers not only to adopt and adapt to the new API framework, but also to go all the way and make typing of endpoints mandatory from the start.</span></p>
<p><span style="font-weight: 400;">Also, we should keep the conversation ongoing to find out how the API framework can serve developers and their needs, instead of just designing it as a rigid service. We even found solutions that they had created themselves, and the framework could officially adopt them for everyone’s benefit.</span></p>
<h2><b>Did it work? How did it end? Did we succeed?</b></h2>
<p><span style="font-weight: 400;">Let&#8217;s assess this with a quote from Etsy’s </span><a href="https://twitter.com/asmorrison"><span style="font-weight: 400;">Andrew Morrison</span></a><span style="font-weight: 400;">, from before all this work started:</span></p>
<p><span style="font-weight: 400;">“</span><i><span style="font-weight: 400;">We desperately need to figure out a scheme for allowing concurrency or else we&#8217;re going to have performance problems forever.</span></i><span style="font-weight: 400;">”</span></p>
<p><span style="font-weight: 400;">YUP! We solved this, and a few unexpected things along the way. Despite initial problems with the extra layer, we figured out unconventional solutions by experimenting and organically growing the system towards the developers needs.</span></p>
<p><span style="font-weight: 400;">Almost the entirety of etsy.com is powered by API v3 now. We are at a point where it is </span><i><span style="font-weight: 400;">very</span></i><span style="font-weight: 400;"> easy to share new web features also with JavaScript and with the Etsy apps.</span></p>
<h2><b>Onwards?</b></h2>
<p><span style="font-weight: 400;">What we are discussing now is how to shift some of the complexity back towards the client. Maybe GraphQL is an interesting approach? Right now, the clients don’t know how the queries will be executed. This makes sense if you have services and teams and clear cut boundaries and interfaces, and if you have a contract in form of an API. Our approach is currently not structured like that.</span></p>
<p><span style="font-weight: 400;">But could we compile an alternative, more knowledgeable PHP client, that lifts the composability from the HTTP layer into the API consumer code, in cases where we are our own consumer and create a website of the same tree structure? It’s clear in this case how many endpoints we are calling, and as long as it&#8217;s us, it&#8217;s safe to lift this control beyond the client, into the view.</span></p>
<p><span style="font-weight: 400;">This is the third post in <a href="https://codeascraft.com/author/sschirmer/">a series of three about Etsy’s API</a>, the abstract interface to our logic and data.</span></p>
]]></content>
		<link rel="replies" type="text/html"
			  href="https://codeascraft.com/2016/11/08/api-first-transformation-human-aspects-developer-adoption/#comments"
			  thr:count="0"/>
		<link rel="replies" type="application/atom+xml"
			  href="https://codeascraft.com/2016/11/08/api-first-transformation-human-aspects-developer-adoption/feed/atom/"
			  thr:count="0"/>
		<thr:total>0</thr:total>
	</entry>
	<entry>
		<author>
			<name>Russ Taylor</name>
		</author>
		<title type="html"><![CDATA[Building a Better Mobile Crash Analytics Platform]]></title>
		<link rel="alternate" type="text/html"
			  href="https://codeascraft.com/2016/11/04/building-a-better-mobile-crash-analytics-platform/"/>
		<id>https://codeascraft.com/?p=4745</id>
		<updated>2016-11-08T22:08:18Z</updated>
		<published>2016-11-04T17:00:24Z</published>
		<category scheme="https://codeascraft.com" term="mobile"/>
		<category scheme="https://codeascraft.com" term="analytics"/>
		<summary type="html">
			<![CDATA[&#8216;Crashcan&#8217; (think trashcan, but for crashes) is Etsy&#8217;s internal application for mobile crash analytics. We use an external partner to collect and store crash and exception data from our mobile apps, which we then ingest via their API. Crashcan is a single-page web app that refines and better exposes the crash data we receive from [&#8230;]]]></summary>
		<content type="html"
				 xml:base="https://codeascraft.com/2016/11/04/building-a-better-mobile-crash-analytics-platform/">
			<![CDATA[<p>&#8216;Crashcan&#8217; (think trashcan, but for crashes) is Etsy&#8217;s internal application for mobile crash analytics. We use an external partner to collect and store crash and exception data from our mobile apps, which we then ingest via their API. Crashcan is a single-page web app that refines and better exposes the crash data we receive from our external partner.</p>
<p><span style="font-weight: 400;"><img class="alignnone wp-image-4747 size-large" src="https://codeascraft.com/wp-content/uploads/2016/11/image01-1024x575.png" alt="Crashcan Preview" width="1024" height="575" srcset="https://codeascraft.com/wp-content/uploads/2016/11/image01-1024x575.png 1024w, https://codeascraft.com/wp-content/uploads/2016/11/image01-300x169.png 300w, https://codeascraft.com/wp-content/uploads/2016/11/image01-768x431.png 768w" sizes="(max-width: 1024px) 100vw, 1024px" /></span></p>
<p><span style="font-weight: 400;">Crashcan gives us extra analysis of our crashes on top of what our partner offers. We can make less cautious assumptions about our stack traces internally, which allows us to group more of them together. It connects crashes to our user data and internal tooling. It allows us to search for crashes in a range of versions. It’s provided a good balance between building our own solution from scratch and completely relying on an external partner. We get the ability to customize our mobile crash reporting without having to maintain an entire crash reporting infrastructure.</span></p>
<h1><span style="font-weight: 400;">Error Reporting &#8211; The Web vs. Mobile</span></h1>
<p><span style="font-weight: 400;">Unfortunately, collecting mobile crashes and exceptions is (of necessity) quite different from most error reporting on the web, in several ways:</span></p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">On the web (especially the desktop web), we can be fairly confident that a user is online &#8211; they’re less prone to flaky or slow connections. Plus, users don’t expect to be able to access the web when they don’t have a connection.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">‘Crashes’ are very different on the web, so many exceptions and errors are less severe. Sure, users may need to refresh a page, but it’s rare that a web page will crash their browser.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">We can watch </span><a href="https://codeascraft.com/2011/02/15/measure-anything-measure-everything/"><span style="font-weight: 400;">graphs</span></a><span style="font-weight: 400;"> and </span><a href="https://github.com/etsy/supergrep"><span style="font-weight: 400;">logs</span></a><span style="font-weight: 400;"> live as we deploy on the web (hooray, continuous deployment!) &#8211; and it&#8217;s clear if hundreds or thousands of exceptions start pouring in. With our mobile apps, however, we have to wait for users to install new versions after a release makes it to the App Store. Only then do we get to see exceptions.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">With mobile, when a crash occurs, we normally can&#8217;t send the crash until the app is launched again (with a data connection) &#8211; in some cases, this can be days or weeks. </span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">App crashes are costly to the user, as the app crashing loses the user’s state. On the web, even if a page breaks for some reason, the user keeps their browser history.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">With the web, there’s one version of Etsy at any point in time. It’s updated continuously, and every user is running the latest version, always. With the apps, we have to deal with multiple versions at once, and we have to wait for users to update.</span></li>
</ul>
<p><span style="font-weight: 400;">With these differences, it&#8217;s been important to approach the analysis of crashes and exceptions differently than we do on the web.</span></p>
<h1><span style="font-weight: 400;">A Crash Analytics Wish List</span></h1>
<p><span style="font-weight: 400;">Many of the issues mentioned above were handled by our external partner. But while this external partner provides a good overview of our mobile crashes, there were still some bits of functionality that would make analyzing crashes significantly easier for us. Some of the functionality we really wanted was:</span></p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">An easy way to filter broad ranges of app versions &#8211; like being able to specify 4.0-4.4 to find all crashes for versions between 4.0.0.0 and 4.4.999.999.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Links between users&#8217; accounts and specific crashes &#8211; like &#8220;This user reported they experienced this crash&#8230; Let&#8217;s find it.&#8221; This coupling with our user database allows us to better determine who is experiencing a crash &#8211; is it just sellers? Just buyers? </span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Better crash de-duplication, specifically handling different versions of our apps and different versions of mobile operating systems. For example, crash traces may be almost identical, but with different line numbers or method names depending on the app version. But if they originate in the same place, we want to group them all together.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Crash categorization &#8211; such as </span><span style="font-weight: 400;">NullPointerException</span><span style="font-weight: 400;">s versus </span><span style="font-weight: 400;">OutOfMemory</span><span style="font-weight: 400;"> errors on Android &#8211; because some types of crashes are fairly easy to fix, while others (like OutOfMemory errors) are often systemic and unactionable.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Custom alerting with various criteria &#8211; like when we experience a new crash with this keyword, or when an old version of our app suddenly experiences new API errors.</span></li>
</ul>
<p><span style="font-weight: 400;">It seemed like it&#8217;d be fairly straightforward to build our own application, using the data we were already collecting, to implement this functionality. We wanted to augment the data we receive from our external partner with data and couple it with our own internal tooling. We also wanted to provide any interested Etsy employees with a simple way to view the overall health of our apps. So that&#8217;s exactly what we chose to do.</span></p>
<h1><span style="font-weight: 400;">Building Crashcan</span></h1>
<p><span style="font-weight: 400;">Crashcan&#8217;s structure was a pretty wide-open space. All it really needed to do was provide crash ingestion from an API, process the crash a bit, and expose it via a simple user interface (it sounds a lot like many technologies, actually). So while the options for technologies and methodologies were open, we ultimately decided to keep it simple.</span></p>
<p><span style="font-weight: 400;">By using PHP, Etsy&#8217;s primary development language, we keep the barrier to entry for developers at Etsy low . We used as much </span><a href="http://www.phptherightway.com"><span style="font-weight: 400;">modern PHP</span></a><span style="font-weight: 400;"> as possible, with </span><a href="https://getcomposer.org"><span style="font-weight: 400;">Composer</span></a><span style="font-weight: 400;"> handling our dependency management. MySQL handles the data storage, with </span><a href="http://www.doctrine-project.org/projects/orm.html"><span style="font-weight: 400;">Doctrine ORM</span></a><span style="font-weight: 400;"> providing the interface to the database.</span></p>
<h2><span style="font-weight: 400;">Data Ingestion</span></h2>
<p><span style="font-weight: 400;">Ingesting the data was the first hurdle. Before handling anything else, we needed to make sure that we could actually (1) get the data we wanted and (2) keep up with the number of crashes that we wanted to ingest, without breaking down our system. After all, if you can&#8217;t get the data you want and you can&#8217;t do so reliably, there&#8217;s really no point.</span></p>
<p><span style="font-weight: 400;">After analyzing the API endpoints we had at our fingertips (yay, documentation!), we determined that we could get all the data we wanted. The architecture needed to allow us to: </span></p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Determine whether we already have a crash (regardless of whether it has been deduplicated on our end)</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Keep track of deduplicated crashes, and link them to the originating crash from the external provider</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Run complex queries to combine data</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Analyze whether crashes are meeting specific thresholds, like whether a new crash has occurred at least <em>n</em> times</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Count crashes by category</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Filter everything by version range and other criteria</span></li>
</ul>
<p><span style="font-weight: 400;">In the end, we developed a schema that allowed us to fulfill all those needs while remaining quick in response to queries:</span></p>
<p><img class="alignnone wp-image-4748 size-full" src="https://codeascraft.com/wp-content/uploads/2016/11/image02.png" alt="Crashcan Schema" width="965" height="500" srcset="https://codeascraft.com/wp-content/uploads/2016/11/image02.png 965w, https://codeascraft.com/wp-content/uploads/2016/11/image02-300x155.png 300w, https://codeascraft.com/wp-content/uploads/2016/11/image02-768x398.png 768w" sizes="(max-width: 965px) 100vw, 965px" /></p>
<p><span style="font-weight: 400;">To actually ingest the data from our external provider, we run a cron job every minute that checks for new crashes. This cron runs a simple loop &#8211; it loads new crashes from a paginated endpoint, looping through each page and each crash in turn. Each crash is added to a queue so that we can update it asynchronously.</span></p>
<p><img class="alignnone size-full wp-image-4752" src="https://codeascraft.com/wp-content/uploads/2016/11/image06.png" alt="Cron Flow" width="546" height="738" srcset="https://codeascraft.com/wp-content/uploads/2016/11/image06.png 546w, https://codeascraft.com/wp-content/uploads/2016/11/image06-222x300.png 222w" sizes="(max-width: 546px) 100vw, 546px" /></p>
<p><span style="font-weight: 400;">We run a series of workers that run continuously, monitoring the queue for incoming crashes. As these workers run, they each pick a crash off the queue and processes it. This includes several steps, first checking whether we have the crash already, then updating it if we have it or creating a new crash if we don’t. We also go through each crash’s occurrences to make sure that we’re recording each one and tying it to an existing user if one exists. The flowchart below demonstrates how these workers process crashes.</span></p>
<p><img class="alignnone size-large wp-image-4749" src="https://codeascraft.com/wp-content/uploads/2016/11/image03-524x1024.png" alt="Workers Flowchart" width="524" height="1024" srcset="https://codeascraft.com/wp-content/uploads/2016/11/image03-524x1024.png 524w, https://codeascraft.com/wp-content/uploads/2016/11/image03-154x300.png 154w, https://codeascraft.com/wp-content/uploads/2016/11/image03-768x1500.png 768w, https://codeascraft.com/wp-content/uploads/2016/11/image03.png 837w" sizes="(max-width: 524px) 100vw, 524px" /></p>
<h2><span style="font-weight: 400;">Monitoring &amp; Alerting</span></h2>
<p><span style="font-weight: 400;">After building Crashcan’s initial design and getting crashes ingesting correctly, we quickly realized that we needed utilities to monitor the data ingestion and to alert us when something went wrong. Initially, we had to manually compare crash counts in Crashcan with those that our external provider offered in their user interface. Obviously, this was neither convenient nor sustainable, so we began integrating </span><a href="https://github.com/etsy/statsd/wiki"><span style="font-weight: 400;">StatsD</span></a><span style="font-weight: 400;"> and </span><a href="https://www.nagios.org/"><span style="font-weight: 400;">Nagios</span></a><span style="font-weight: 400;">. To check that we were still ingesting all our crashes, we also wrote a script to perform a sort of ‘spot-check’ of our data against our external provider’s &#8211; which fails if our data differs too much from theirs.</span></p>
<p><img class="alignnone size-large wp-image-4746" src="https://codeascraft.com/wp-content/uploads/2016/11/image00-1024x587.png" alt="Crashcan Monitoring Graphs" width="1024" height="587" srcset="https://codeascraft.com/wp-content/uploads/2016/11/image00-1024x587.png 1024w, https://codeascraft.com/wp-content/uploads/2016/11/image00-300x172.png 300w, https://codeascraft.com/wp-content/uploads/2016/11/image00-768x440.png 768w, https://codeascraft.com/wp-content/uploads/2016/11/image00.png 1367w" sizes="(max-width: 1024px) 100vw, 1024px" /></p>
<p><span style="font-weight: 400;">We created a simple dashboard, linked to StatsD, that allows us to see at-a-glance if the ingestion is going well &#8211; or if we’re encountering errors, slowness, or hitting our API limit. While we plan to improve our alerting infrastructure over time, this has been serving us well for now &#8211; though before we got our monitoring in a good state, we hit some big snags that kept us from being able to use Crashcan for weeks at a time. There’s an important lesson there: </span><i><span style="font-weight: 400;">plan for monitoring and alerting from the beginning</span></i><span style="font-weight: 400;">. </span></p>
<h2><span style="font-weight: 400;">Application Structure</span></h2>
<p><span style="font-weight: 400;">When deciding on Crashcan’s structure, we decided to focus first on building a stable, straightforward </span><a href="https://en.wikipedia.org/wiki/Application_programming_interface"><span style="font-weight: 400;">API</span></a><span style="font-weight: 400;">. This would enable us to expose our crash data to both users and other applications &#8211; with one interface for accessing the data. This meant that it was simple for us to build Crashcan’s user interface as a </span><a href="https://en.wikipedia.org/wiki/Single-page_application"><span style="font-weight: 400;">Single Page Application</span></a><span style="font-weight: 400;">. Very few of the </span><a href="http://adamsilver.io/articles/the-disadvantages-of-single-page-applications/"><span style="font-weight: 400;">disadvantages of single page applications</span></a><span style="font-weight: 400;"> applied in Crashcan’s case, since our users would only be other Etsy employees. Building a robust API also enabled us to share the data easily with other applications inside Etsy &#8211; most especially with our internal app release platform.</span></p>
<p><img class="alignnone size-large wp-image-4751" src="https://codeascraft.com/wp-content/uploads/2016/11/image05-1024x1021.png" alt="App Overview View" width="1024" height="1021" srcset="https://codeascraft.com/wp-content/uploads/2016/11/image05-1024x1021.png 1024w, https://codeascraft.com/wp-content/uploads/2016/11/image05-150x150.png 150w, https://codeascraft.com/wp-content/uploads/2016/11/image05-300x300.png 300w, https://codeascraft.com/wp-content/uploads/2016/11/image05-768x766.png 768w, https://codeascraft.com/wp-content/uploads/2016/11/image05-32x32.png 32w, https://codeascraft.com/wp-content/uploads/2016/11/image05-50x50.png 50w, https://codeascraft.com/wp-content/uploads/2016/11/image05-64x64.png 64w, https://codeascraft.com/wp-content/uploads/2016/11/image05-96x96.png 96w, https://codeascraft.com/wp-content/uploads/2016/11/image05-128x128.png 128w, https://codeascraft.com/wp-content/uploads/2016/11/image05.png 1206w" sizes="(max-width: 1024px) 100vw, 1024px" /></p>
<p><span style="font-weight: 400;">When an Etsy engineer accesses Crashcan, we aim to present them with the most broadly applicable information first &#8211; the overall health of an app. This is presented through an overview of frequent crashes, common crash categories, and new crashes, along with a graph showing all crashes for the app split out by version. This makes it much easier to spot big new crashes or problematic releases. The engineer then has the option to narrow the scope of their search and view the details of specific crashes.</span></p>
<p><img class="alignnone size-large wp-image-4750" src="https://codeascraft.com/wp-content/uploads/2016/11/image04-1005x1024.png" alt="Crash Preview" width="1005" height="1024" srcset="https://codeascraft.com/wp-content/uploads/2016/11/image04-1005x1024.png 1005w, https://codeascraft.com/wp-content/uploads/2016/11/image04-295x300.png 295w, https://codeascraft.com/wp-content/uploads/2016/11/image04-768x782.png 768w, https://codeascraft.com/wp-content/uploads/2016/11/image04-32x32.png 32w, https://codeascraft.com/wp-content/uploads/2016/11/image04-50x50.png 50w, https://codeascraft.com/wp-content/uploads/2016/11/image04-64x64.png 64w, https://codeascraft.com/wp-content/uploads/2016/11/image04.png 1412w" sizes="(max-width: 1005px) 100vw, 1005px" /></p>
<h1><span style="font-weight: 400;">Ongoing Work</span></h1>
<p><span style="font-weight: 400;">While we’ve finished Crashcan v1 with much of the core functionality and gotten it in a stable enough state that we can depend on its data, there’s still quite a bit that we’d like to improve. For example, we haven’t even begun to implement a couple of the items we mentioned in our wish list, like custom alerting. Second, the user interface could do with some bugfixes and refinement. Right now, it’s in a mostly-usable state that other Etsy engineers can at least tolerate, but it’s not stable or refined enough that we’d be comfortable releasing it to a wider audience.</span></p>
<p><span style="font-weight: 400;">Additionally, our crash deduplication is still rudimentary. It only performs simple (and expensive) string comparisons to find similar crashes. We’d like to implement more advanced and more efficient crash deduplication using crash signature generation. This would give us a much more reliable way of determining when crashes are related, therefore providing a more accurate picture of how common each crash is.</span></p>
<h1><span style="font-weight: 400;">Lessons Learned</span></h1>
<p><span style="font-weight: 400;">Most of the pain points in Crashcan’s development weren’t new or especially unexpected, but they serve as a valuable reminder of some important considerations when building new applications. </span></p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Build with monitoring and alerting in mind from the beginning. We could’ve avoided a several-week-long lapse in functionality had we focused on building in monitoring from the beginning.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Don’t be afraid to consult with others on structural or technical decisions, and then just </span><i><span style="font-weight: 400;">make a decision</span></i><span style="font-weight: 400;">. It’s something that I’ve always struggled with &#8211; but getting blocked on making decisions or digging too deep into the minutiae of every decision is a great way to waste time.</span></li>
<li><span style="font-weight: 400;">Document your assumptions &#8211; especially when dealing with APIs &#8211; as small assumptions can turn into big deals later on. This is what led to our biggest failure &#8211; we mistakenly assumed that crash timestamps were accurate. When a crash said it had occurred 4 days in the future, our app stopped updating, because it was checking only crashes occurring </span><i><span style="font-weight: 400;">after</span></i><span style="font-weight: 400;"> that crash.</span></li>
</ul>
]]></content>
		<link rel="replies" type="text/html"
			  href="https://codeascraft.com/2016/11/04/building-a-better-mobile-crash-analytics-platform/#comments"
			  thr:count="0"/>
		<link rel="replies" type="application/atom+xml"
			  href="https://codeascraft.com/2016/11/04/building-a-better-mobile-crash-analytics-platform/feed/atom/"
			  thr:count="0"/>
		<thr:total>0</thr:total>
	</entry>
	<entry>
		<author>
			<name>Bill Ulammandakh</name>
		</author>
		<title type="html">
			<![CDATA[SEO Title Tag Optimization at Etsy: Experimental Design and Causal Inference]]></title>
		<link rel="alternate" type="text/html" href="https://codeascraft.com/2016/10/25/seo-title-tag-optimization/"/>
		<id>https://codeascraft.com/?p=4725</id>
		<updated>2017-02-19T02:42:45Z</updated>
		<published>2016-10-25T18:56:24Z</published>
		<category scheme="https://codeascraft.com" term="data"/>
		<category scheme="https://codeascraft.com" term="engineering"/>
		<category scheme="https://codeascraft.com" term="analytics"/>
		<category scheme="https://codeascraft.com" term="data science"/>
		<category scheme="https://codeascraft.com" term="experimentation"/>
		<category scheme="https://codeascraft.com" term="marketing"/>
		<category scheme="https://codeascraft.com" term="marketing analytics"/>
		<category scheme="https://codeascraft.com" term="seo"/>
		<summary type="html">
			<![CDATA[External search engines like Google and Bing are a major source of traffic for Etsy, especially for our longer-tail, harder to find items, and thus Search Engine Optimization (SEO) is important in driving efficient listing discovery on our platform. We want to make sure that our SEO strategy is data-driven and that we can be [&#8230;]]]></summary>
		<content type="html" xml:base="https://codeascraft.com/2016/10/25/seo-title-tag-optimization/"><![CDATA[<p><span style="font-weight: 400">External search engines like Google and Bing are a major source of traffic for Etsy, especially for our longer-tail, harder to find items, and thus Search Engine Optimization (SEO) is important in driving efficient listing discovery on our platform. </span></p>
<p><span style="font-weight: 400">We want to make sure that our SEO strategy is data-driven and that we can be highly confident that whatever changes we implement will bring about positive results. At Etsy, we constantly run experiments to optimize the user experience and discovery across our platform, and we therefore naturally turned to experimentation for improving our SEO performance. While it is relatively simple to set up an experiment on-site on our own pages and apps, running experiments with SEO required changing how Etsy’s pages appeared in search engine results, over which we did not have direct control.</span></p>
<p><span style="font-weight: 400">To overcome this limitation, we designed a slightly modified experimental design framework that allows us to effectively test how changes to our pages affect our SEO performance. This post explains the methodology behind our SEO testing, the challenges we have come across, and how we have resolved them.</span></p>
<h2><b>Experiment Methodology</b></h2>
<p><span style="font-weight: 400">For one of our experiments, we hypothesized that changing the titles our pages displayed in search results (a.k.a. ‘title tags’) could increase their clickthrough rate. Etsy has millions of pages generated off of user generated content that were suitable for a test. Many of these pages also receive the majority of their traffic through SEO.</span></p>
<p><span style="font-weight: 400">Below is an example of a template we used when setting up a recent SEO title tag experiment.</span></p>
<p><img class="aligncenter wp-image-4730" src="https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.46.00-AM-936x1024.png" alt="experiment_variants" width="600" height="656" srcset="https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.46.00-AM-936x1024.png 936w, https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.46.00-AM-274x300.png 274w, https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.46.00-AM-768x840.png 768w, https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.46.00-AM.png 1232w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p><span style="font-weight: 400">We were inspired by SEO tests at </span><a href="https://engineering.pinterest.com/blog/demystifying-seo-experiments"><span style="font-weight: 400">Pinterest</span></a><span style="font-weight: 400"> and </span><a href="https://www.thumbtack.com/engineering/seo-tip-titles-matter-probably-more-than-you-think/"><span style="font-weight: 400">Thumbtack</span></a><span style="font-weight: 400"> and decided to set up a similar experiment where we randomly assigned our pages into different groups and applied different title tag phrasings shown above. We would measure the success of each test group by how much traffic it drove relative to the control groups. In this experiment, we also set up two control groups to have a higher degree of confidence in our results and to be able to quality check our randomized sampling once the experiment began. </span></p>
<h3><b>Sampling</b></h3>
<p><span style="font-weight: 400"> We took a small sample of pages of a similar type while ensuring that our sample was large enough  to allow us to reach statistical significance within a reasonable amount of time.</span></p>
<p><img class="aligncenter wp-image-4731" src="https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.46.19-AM-1024x712.png" alt="experiment_variants" width="600" height="417" srcset="https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.46.19-AM-1024x712.png 1024w, https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.46.19-AM-300x209.png 300w, https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.46.19-AM-768x534.png 768w, https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.46.19-AM.png 1420w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p><span style="font-weight: 400">Because visits to individual pages are highly volatile, with many outliers and fluctuations from day to day, we had to create relatively large groups of 1000 pages each to expect to reach significance quickly. Furthermore, because of the high degree of variance across our pages, simple random sampling of our pages into test groups was creating test groups different from each other in a statistically significant way even before the experiment began.</span></p>
<p><span style="font-weight: 400">To ensure our test groups were more comparable to each other, we used <a href="https://en.wikipedia.org/wiki/Stratified_sampling">stratified sampling</a>, where we first ranked the the pages to be a part of the test by visits, broke them down into ntile groups and then randomly assigned the pages from each ntile group into one of the test groups, ensuring to take a page from each ntile group. This ensured that our test groups were consistently representative of the overall sample and more reliably similar to each other. </span></p>
<p><img class="aligncenter wp-image-4732" src="https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.46.30-AM-1024x504.png" alt="stratified_sampling" width="600" height="295" srcset="https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.46.30-AM-1024x504.png 1024w, https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.46.30-AM-300x148.png 300w, https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.46.30-AM-768x378.png 768w, https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.46.30-AM.png 1332w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p><span style="font-weight: 400">We then looked at the statistical metrics for each test group over the preceding time period, calculating the mean and standard deviation values by month and running t-tests to ensure the groups were not different from each other in a statistically significant way. All test groups passed this test.</span></p>
<h2><img class="aligncenter wp-image-4733" src="https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.46.37-AM-1024x771.png" alt="experiment_test_groups" width="600" height="452" srcset="https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.46.37-AM-1024x771.png 1024w, https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.46.37-AM-300x226.png 300w, https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.46.37-AM-768x578.png 768w, https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.46.37-AM.png 1418w" sizes="(max-width: 600px) 100vw, 600px" /></h2>
<h3><b>Estimating Causal Impact</b></h3>
<p><span style="font-weight: 400">Although the test groups in our experiment were not different from each other at a statistically significant level before the experiment, there were small differences that prevented the estimation of the exact causal impact post treatment. For example, test group XYZ might see an increase relative to control B, but if Control B was slightly better than test groups XYZ even before the experiment began, simply taking the difference between of the two groups would not be the best estimate of the difference the treatment had effected.</span></p>
<p><span style="font-weight: 400">One common approach to resolve this problem is to calculate the difference of differences between the test and control groups pre- and post-treatment.</span></p>
<p><span style="font-weight: 400">While this approach would have worked well, it might have created two different estimated treatment effect sizes when comparing the test groups against the two different control groups. We decided that, instead, using Bayesian structural time series analysis to create a synthetic control group incorporating information from both the control groups would provide a cleaner analysis of the results. </span></p>
<p><span style="font-weight: 400">In this approach, a machine learning model is trained using pre-treatment data to predict the performance of each test group based on its covariance relative to its predictors &#8212; in our case, the two control groups. Once the model is trained, it is used to generate the counterfactual, synthetic control groups for each of the test groups, simulating what would have happened had the treatment not been applied.</span></p>
<p><span style="font-weight: 400">The causal impact analysis in this experiment was implemented using the </span><a href="https://google.github.io/CausalImpact/CausalImpact.html"><span style="font-weight: 400">CausalImpact</span></a><span style="font-weight: 400"> package by Google.</span></p>
<h2><b>Results</b></h2>
<p><span style="font-weight: 400">We started seeing the effects of our test treatments as soon as a few days after the experiment start date. Even seemingly very subtle title tag changes resulted in large and statistically significant changes in traffic to our pages.</span></p>
<p><span style="font-weight: 400">In some test groups, we saw significant gains in traffic.</span></p>
<p><img class="aligncenter wp-image-4734" src="https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.46.47-AM-1024x624.png" alt="experiment_variant" width="600" height="366" srcset="https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.46.47-AM-1024x624.png 1024w, https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.46.47-AM-300x183.png 300w, https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.46.47-AM-768x468.png 768w, https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.46.47-AM.png 1398w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p><span style="font-weight: 400">While in others, we saw no change.</span></p>
<p><img class="aligncenter wp-image-4735" src="https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.47.03-AM-1024x612.png" alt="experiment_variant" width="600" height="358" srcset="https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.47.03-AM-1024x612.png 1024w, https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.47.03-AM-300x179.png 300w, https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.47.03-AM-768x459.png 768w, https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.47.03-AM.png 1416w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p><span style="font-weight: 400">And in some others, we even saw a strong negative change in traffic.</span></p>
<p><img class="aligncenter wp-image-4736" src="https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.47.11-AM-1024x628.png" alt="experiment_variant" width="600" height="368" srcset="https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.47.11-AM-1024x628.png 1024w, https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.47.11-AM-300x184.png 300w, https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.47.11-AM-768x471.png 768w, https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.47.11-AM.png 1396w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<h3><b>A-A Testing </b></h3>
<p><span style="font-weight: 400">The two control groups in this test showed no statistically significant difference compared to each other after the experiment. Although a slight change was detected, the effect did not reach significance.</span></p>
<h3><b>Post-experiment rollout validation</b></h3>
<p><span style="font-weight: 400">Once we identified the best performing title tag, the treatment was rolled out across all test groups. The other groups experienced similar lifts in traffic and the variance across buckets disappeared, further validating our results.</span></p>
<p><img class="aligncenter wp-image-4737" src="https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.47.23-AM-1024x679.png" alt="experiment_rollout" width="600" height="398" srcset="https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.47.23-AM-1024x679.png 1024w, https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.47.23-AM-300x199.png 300w, https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.47.23-AM-768x509.png 768w, https://codeascraft.com/wp-content/uploads/2016/10/Screen-Shot-2016-10-25-at-11.47.23-AM.png 1454w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p><span style="font-weight: 400">The fact that our two control groups saw no change when compared to each other, and also the fact that the other buckets experienced the same improvement in performance once the best performing treatment was applied to them gave us strong basis for confidence in the validity of our results.</span></p>
<h2><b>Discussion</b></h2>
<p><span style="font-weight: 400">It appeared in our results that shorter title tags performed better than longer ones. This might be because for shorter, better targeted title tags, there is a higher probability of a percentage match (that could be calculated using a metric like the </span><a href="https://en.wikipedia.org/wiki/Levenshtein_distance"><span style="font-weight: 400">Levenshtein Distance</span></a><span style="font-weight: 400"> between the search query and the title tag) against any given user’s search query on Google.</span></p>
<p><span style="font-weight: 400">In a similar hypothesis, it might be that using well-targeted title tags that are more textually similar to common search terms helps to increase percentage match to Google search terms and therefore improves ranking.</span></p>
<p><span style="font-weight: 400">However, it is likely that different strategies work well for different websites, and we would recommend rigorous testing to uncover the best SEO strategy tailored for each individual case.</span></p>
<h2><b>Takeaways</b></h2>
<ul>
<li style="font-weight: 400"><span style="font-weight: 400">Have two control groups for A-A testing. This allowed us to have much greater confidence in our results.</span></li>
<li style="font-weight: 400"><span style="font-weight: 400">The CausalImpact package can be used to easily account for small differences in test vs. control groups and estimate the differences of treatments more accurately.</span></li>
<li style="font-weight: 400"><span style="font-weight: 400">For title tags, it is most likely a best practice to use phrasing and wording that would maximize the probability of a low Levenshtein distance match from popular target search queries on Google</span></li>
</ul>
<p>&nbsp;</p>
<p><b>Image Credits:</b></p>
<p><a href="http://www.fernuni-hagen.de/statliteracy/images/Stratifiedsampling.jpg"><span style="font-weight: 400">Visualization of Stratified Sampling</span></a></p>
]]></content>
		<link rel="replies" type="text/html"
			  href="https://codeascraft.com/2016/10/25/seo-title-tag-optimization/#comments" thr:count="64"/>
		<link rel="replies" type="application/atom+xml"
			  href="https://codeascraft.com/2016/10/25/seo-title-tag-optimization/feed/atom/" thr:count="64"/>
		<thr:total>64</thr:total>
	</entry>
	<entry>
		<author>
			<name>Toria Gibbs</name>
		</author>
		<title type="html"><![CDATA[Being an Effective Ally to Women and Non-Binary People]]></title>
		<link rel="alternate" type="text/html"
			  href="https://codeascraft.com/2016/10/19/being-an-effective-ally-to-women-and-non-binary-people/"/>
		<id>https://codeascraft.com/?p=4719</id>
		<updated>2016-12-21T17:28:46Z</updated>
		<published>2016-10-19T16:43:40Z</published>
		<category scheme="https://codeascraft.com" term="philosophy"/>
		<category scheme="https://codeascraft.com" term="allyship"/>
		<category scheme="https://codeascraft.com" term="diversity"/>
		<category scheme="https://codeascraft.com" term="feminism"/>
		<category scheme="https://codeascraft.com" term="gender"/>
		<category scheme="https://codeascraft.com" term="inclusion"/>
		<category scheme="https://codeascraft.com" term="women in tech"/>
		<summary type="html">
			<![CDATA[This post is based on a talk and workshop that Toria and Ian gave at Etsy’s Dublin office in August. Etsy has a strong set of beliefs that underpins our engineering culture. We believe in code as craft. We believe that if it moves, you should graph it. And we believe that when you’ve got [&#8230;]]]></summary>
		<content type="html"
				 xml:base="https://codeascraft.com/2016/10/19/being-an-effective-ally-to-women-and-non-binary-people/">
			<![CDATA[<p><i><span style="font-weight: 400;">This post is based on a talk and workshop that </span></i><a href="https://twitter.com/scarletdrive"><i><span style="font-weight: 400;">Toria</span></i></a><i><span style="font-weight: 400;"> and </span></i><a href="https://twitter.com/indec"><i><span style="font-weight: 400;">Ian</span></i></a><i><span style="font-weight: 400;"> gave at Etsy’s Dublin office in August.</span></i></p>
<p><span style="font-weight: 400;">Etsy has a strong set of beliefs that underpins our engineering culture. We believe in code as craft. We believe that if it moves, you should graph it. And we believe that when you’ve got some working code ready, you should &#8220;just ship&#8221; it.</span></p>
<p><span style="font-weight: 400;">This practice of &#8220;just shipping&#8221; is known as </span><a href="https://codeascraft.com/2011/02/04/how-does-etsy-manage-development-and-operations/"><span style="font-weight: 400;">continuous deployment</span></a><span style="font-weight: 400;">. We make small changes frequently, and we hide them behind &#8220;config flags&#8221; that let us test our work incrementally before a full feature launch. Etsy engineers collectively deploy code to the production site as many as 70 times per day.</span></p>
<p><span style="font-weight: 400;">Now imagine for a minute that you’re an engineer at an organization doing continuous deployment. You’ve got a small change ready to deploy. Your code is good. Tests pass. It’s all been reviewed. But every time you try to deploy, something goes wrong. This happens all the time, but </span><i><span style="font-weight: 400;">only to you</span></i><span style="font-weight: 400;">. Every time you try to deploy, you have to spend half an hour trying to fix the deploy system. No one else is motivated to fix anything because it works just fine for them. The deploy system is better for everyone because of your investigations, but fixing the deploy system isn’t part of your job. You just want to ship code!</span></p>
<p><span style="font-weight: 400;">What would be great is if some other engineers would pitch in and do the work too, so that you have more time to do your actual job. What you need are </span><i><span style="font-weight: 400;">allies</span></i><span style="font-weight: 400;">.</span></p>
<p><span style="font-weight: 400;">Surprise! That was a thinly-veiled metaphor for what it feels like to be a member of an underrepresented group trying to improve their work environment. Relying on members of minority groups to shoulder the burden of diversity issues is just as flawed as expecting one person to do all the work to fix a broken deploy system. You can&#8217;t excel at your job when you spend half your time dealing with </span><i><span style="font-weight: 400;">other stuff</span></i><span style="font-weight: 400;">. We need ways of spreading the load. We need allies. And we hope that’s why you’re reading this now.</span></p>
<h2><span style="font-weight: 400;">Terminology</span></h2>
<p><span style="font-weight: 400;">So what is an ally? Let’s start by defining some important terms so that we’re all on the same page.</span></p>
<h3><span style="font-weight: 400;">Women, men, and non-binary people</span></h3>
<p><span style="font-weight: 400;">At Etsy, we recognize that gender is non-binary: it lies on a spectrum. When we use the term &#8220;men&#8221; here, we&#8217;re talking about anybody who identifies as a man and experiences the benefits of male privilege. When we say &#8220;women&#8221;, we&#8217;re talking about anybody who identifies as a woman. Some people don&#8217;t fall into either of these categories: they are </span><a href="http://nonbinary.org/wiki/Nonbinary_gender"><span style="font-weight: 400;">non-binary</span></a><span style="font-weight: 400;">. Gender discrimination impacts these people too, and as such you’ll see references to them throughout this post.</span></p>
<p><span style="font-weight: 400;">Much of the discrimination that people face depends on how </span><i><span style="font-weight: 400;">society</span></i><span style="font-weight: 400;"> identifies their gender, rather than how </span><i><span style="font-weight: 400;">they themselves</span></i><span style="font-weight: 400;"> identify. A person with a beard is likely to be treated like a man regardless of their chosen gender, but they still have to deal with bias and prejudice in their daily life.</span></p>
<h3><span style="font-weight: 400;">Feminism</span></h3>
<blockquote><p><span style="font-weight: 400;">&#8220;Feminism is the radical notion that women are people.&#8221; — Marie Shear</span></p></blockquote>
<p><span style="font-weight: 400;">Of course women (and non-binary folks) are people. But while we think &#8220;</span><i><span style="font-weight: 400;">of course</span></i><span style="font-weight: 400;"> they’re people&#8221;, we tend to overlook the countless ways in which society as a whole undervalues women and their work: lower wages for the same work or </span><a href="http://www.payscale.com/data-packages/gender-pay-gap"><span style="font-weight: 400;">overall lower wages in industries dominated by women</span></a><span style="font-weight: 400;">, portrayals of women as prizes to be won or objects to have, and the ignoring or ridiculing of problems faced by women, to name but a few.</span></p>
<h3><span style="font-weight: 400;">Intersectional feminism</span></h3>
<p><span style="font-weight: 400;">As you learn more about feminism, another term you’ll see is &#8220;intersectional feminism&#8221;. Intersectionality is the recognition that people are complex beings with multiple axes of identity. Although we&#8217;re talking primarily about gender here, a person&#8217;s identity is not solely defined by their gender. Intersectional feminism acknowledges that we can’t solve problems for all women without considering that women have different experiences based on their race, religion, sexuality, gender expression, or able-bodiedness.</span></p>
<p><span style="font-weight: 400;">Good news! Allyship is also intersectional! If you&#8217;re white, you can serve as an ally to people of color. If you can see, you can serve as an ally to people with vision loss. If you&#8217;re a man, you can serve as an ally to women. If you&#8217;re cisgender, you can serve as an ally to folks who are trans, non-binary, or genderqueer.</span></p>
<p><span style="font-weight: 400;">Consider intersectionality throughout this post. Ask yourself how these techniques for allyship can be applied for other underrepresented groups.</span></p>
<h3><span style="font-weight: 400;">Privilege</span></h3>
<p><span style="font-weight: 400;">The idea of privilege is often a massive stumbling block for people. We rebel against the idea that we have had an unfair advantage in life. &#8220;I had to work hard,” you&#8217;ll hear people claim. &#8220;I&#8217;ve struggled for everything I&#8217;ve got.”</span></p>
<p><span style="font-weight: 400;">Privilege does not mean you had it </span><i><span style="font-weight: 400;">easy</span></i><span style="font-weight: 400;">. It means you had it </span><i><span style="font-weight: 400;">easier</span></i><span style="font-weight: 400;">. If a man grows up in poverty, and drags himself out of it, that&#8217;s impressive. That&#8217;s hard. If he&#8217;d been a woman, he&#8217;d have had to do all the same things, while also fighting society&#8217;s expectations of what women can or should do. </span><a href="https://twitter.com/kronda/status/782362415979606017"><span style="font-weight: 400;">Privilege is what you </span><i><span style="font-weight: 400;">don’t</span></i><span style="font-weight: 400;"> have to deal with</span></a><span style="font-weight: 400;">.</span></p>
<p><span style="font-weight: 400;">In the opening example, everyone else ships more than you—not because they&#8217;re better than you, but because they don&#8217;t have to deal with the additional nonsense that you do.</span></p>
<p><span style="font-weight: 400;">Understanding privilege—and understanding and accepting your own privilege—is a vital part of becoming an effective ally. You’re not being asked to beat yourself up about it, you’re being asked to empathize with others who are less privileged so that you can do something about it.</span></p>
<h3><span style="font-weight: 400;">Patriarchy</span></h3>
<p><span style="font-weight: 400;">Along with &#8220;privilege&#8221;, &#8220;patriarchy&#8221; is another term that trips people up. It brings to mind a shadowy cabal of men pulling strings and malevolently excluding women. This is&#8230; silly.</span></p>
<p><span style="font-weight: 400;">Instead, the term “patriarchy” refers to </span><i><span style="font-weight: 400;">structural</span></i><span style="font-weight: 400;"> sexism and gender discrimination. We are raised in a society that historically and systematically favors men over women. This colors everything we do and everything we see. We&#8217;re surrounded by the fruits of this bias, steeped in it from birth. Just one example: studies show that, from an early age, girls are held to higher standards of politeness, while boys are expected to speak dominantly and assertively, </span><a href="https://kateheddleston.com/blog/argument-cultures-and-unregulated-aggression"><span style="font-weight: 400;">producing power imbalances in conversations</span></a><span style="font-weight: 400;"> that continue through to our adult interactions.</span></p>
<p><span style="font-weight: 400;">Patriarchy perpetuates itself. Not through conscious malevolence (most of the time), but because male-dominated power structures tend to stack the deck against women gaining power, and so produce more male-dominated power structures.</span></p>
<h3><span style="font-weight: 400;">Unconscious bias</span></h3>
<p><span style="font-weight: 400;">The perpetuation of the patriarchy is rooted in unconscious bias. These are biases we don&#8217;t even realize we have, but which influence how we think and act. They are instilled in us over the years by repetitive stimuli from our environment.</span></p>
<p><span style="font-weight: 400;">Consider the following story: &#8220;A man and his son were in a car accident. The man died on the way to the hospital, but the boy was rushed into surgery. The surgeon said: ‘I can’t operate! That’s my son!’&#8221;</span></p>
<p><span style="font-weight: 400;">The first time most people are presented with this, they fail to realize the surgeon is the boy’s mother. Mental blind spots like this one show that we are all a little bit sexist. (As a side note, this thought experiment has been around for many years. In recent years, respondents have often thought the surgeon was the boy’s </span><i><span style="font-weight: 400;">other father</span></i><span style="font-weight: 400;">. They are more willing to accept a gay male couple than a female surgeon.)</span></p>
<p><span style="font-weight: 400;">Dr. Catherine Ashcraft from the </span><a href="https://www.ncwit.org/"><span style="font-weight: 400;">National Center for Women and Information Technology</span></a><span style="font-weight: 400;"> (NCWIT) gave a lecture at Etsy on unconscious bias. She talked about some </span><a href="https://implicit.harvard.edu/implicit/takeatest.html"><span style="font-weight: 400;">experiments for quantifying gender bias</span></a><span style="font-weight: 400;">. The NCWIT staff took these tests, and </span><i><span style="font-weight: 400;">all</span></i><span style="font-weight: 400;"> the participants were found to be unconsciously biased against women. To repeat: </span><i><span style="font-weight: 400;">women</span></i><span style="font-weight: 400;">, working for the </span><i><span style="font-weight: 400;">National Center for Women and Information Technology</span></i><span style="font-weight: 400;">, working to bring gender diversity to our sector, were </span><i><span style="font-weight: 400;">all</span></i><span style="font-weight: 400;"> biased against women.</span></p>
<p><span style="font-weight: 400;">We are all trained, over time, to have these habitual, instinctive responses to situations. When these unconscious biases are challenged, we tend to react negatively. For example, women who adopt more traditionally male behaviors and speech patterns in the workplace are often </span><a href="http://www.independent.co.uk/news/business/women-bosses-more-likely-to-be-called-bitchy-emotional-and-bossy-10090606.html"><span style="font-weight: 400;">perceived</span></a><span style="font-weight: 400;"> more </span><a href="http://fortune.com/2014/08/26/performance-review-gender-bias/"><span style="font-weight: 400;">negatively</span></a><span style="font-weight: 400;"> than women who fit society’s expectations.</span></p>
<p><span style="font-weight: 400;">What we can do, however, is make conscious corrections. We can actively try to overcome these unconscious biases.</span></p>
<h3><span style="font-weight: 400;">Microaggression</span></h3>
<p><span style="font-weight: 400;">The best way to combat unconscious bias is to recognize that it exists and identify when it’s happening. It’s easy to identify and &#8220;call out&#8221; overtly sexist behavior, but what about the more subtle and ambiguous stuff?</span></p>
<p><span style="font-weight: 400;">Casual phrases like &#8220;you’re really good at sports for a girl!&#8221; or &#8220;going out with the guys tonight; leaving the old ball and chain at home!&#8221;, using gendered phrases like &#8220;the ops guys&#8221;, speaking over women in meetings, repeating their ideas as your own, expecting them to do clerical work like note-taking, or standing over them at a desk in a dominant position: these are examples of microaggressions. They’re the &#8220;little things&#8221; that, examined individually, don’t always seem like a big enough deal to make a fuss over. &#8220;Maybe it was a joke?&#8221; &#8220;Maybe he didn’t mean it that way?&#8221; &#8220;It’s just an expression!&#8221;</span></p>
<p><span style="font-weight: 400;">But microaggressions are cumulative. Over time, these subtle comments build and reinforce traditional power structures by reminding women and non-binary individuals of their position in society.</span></p>
<p><span style="font-weight: 400;">We must notice these subtle, often unconscious microaggressions in others—and in ourselves—in order to correct them.</span></p>
<h3><span style="font-weight: 400;">Ally</span></h3>
<p><span style="font-weight: 400;">And that brings us to &#8220;ally&#8221;: the key part of this post. An ally is a member of a privileged group (in this case, men) who works to enable opportunity, access, and equality for members of a non-privileged group (in this case, women and non-binary people). They are using their privilege, their advantages, to bring about change.</span></p>
<h2><span style="font-weight: 400;">How can allies help?</span></h2>
<p><span style="font-weight: 400;">So… centuries—millennia!—of systematic discrimination against women. Biases baked into us from birth! Society fundamentally biased against women! This is an overwhelming problem. It&#8217;s hard to know where to start.</span></p>
<p><span style="font-weight: 400;">Like any large, complex problem, begin by breaking it down into smaller, more manageable parts. Start at your workplace. If you can make a difference there, you not only improve the lives of the less-privileged people you work with, but you also improve your working environment. </span><a href="https://hbr.org/2016/04/were-making-the-wrong-case-for-diversity-in-silicon-valley"><span style="font-weight: 400;">Research shows</span></a><span style="font-weight: 400;"> that more diverse teams, with more diverse perspectives and experiences, make better decisions and build better products.</span></p>
<p><span style="font-weight: 400;">Start today. You’ve read this far, so you’re already interested in making a difference. Don’t wait until you’re an &#8220;expert&#8221; on feminist theory to start speaking up. Just start trying. And just like with continuous deployment, when you mess up (and everyone does), get feedback, listen, learn, fix the problem, and try again.</span></p>
<p><span style="font-weight: 400;">Now you’re ready to start, but as a member of a privileged group, what can you do? What do allies offer?</span></p>
<ul>
<li style="font-weight: 400;"><b>Power and authority</b><span style="font-weight: 400;">. In male-dominated power structures, men tend to have more powerful and influential positions and voices. Use those voices to speak on behalf of those with less privilege.</span></li>
<li style="font-weight: 400;"><b>Access</b><span style="font-weight: 400;">. Our networks tend to look like ourselves, so men tend to have networks full of other (powerful) men. Provide access to these networks.</span></li>
<li style="font-weight: 400;"><b>Amplification</b><span style="font-weight: 400;">. In addition to speaking up on behalf of women and non-binary individuals, men should amplify and endorse their words and achievements.</span></li>
<li style="font-weight: 400;"><b>Modeling</b><span style="font-weight: 400;">. Allies model good behavior and interactions, such as talking openly with others about gender discrimination or being vocal about addressing their unconscious biases.</span></li>
<li style="font-weight: 400;"><b>Teaching</b><span style="font-weight: 400;">. Expose other privileged people to the concepts you learn about. People from marginalized groups are often expected to do the teaching and allies can share the load.</span></li>
</ul>
<h2><span style="font-weight: 400;">Ten Steps to Being An Effective Ally</span></h2>
<p><span style="font-weight: 400;">Being an ally is a constant learning experience. Being an ally isn&#8217;t a fixed state, it&#8217;s not a badge you earn (or take) and sew onto your sleeve and you&#8217;re an ally from then on. Being open to feedback and demonstrating that you’re willing to accept and learn from criticism is vital. More than anything, &#8220;ally&#8221; is a status accorded to you by those that you’re trying to help, based on your words and actions.</span></p>
<p><span style="font-weight: 400;">So, how do we ally?</span></p>
<h3><span style="font-weight: 400;">1. Educate yourself</span></h3>
<p><span style="font-weight: 400;">There are a ton of resources out there for you to learn from. Make the effort to educate yourself, rather than demanding that marginalized people explain things to you. You wouldn’t ask Rasmus Lerdorf, inventor of the PHP programming language, to explain basic PHP concepts. You would Google it. You would go out and find the articles, tutorials, and forum threads that already exist for beginners. There is already material for you to learn from: go out, find it, and read it. (We’ve created a </span><a href="https://codeascraft.com/2016/08/10/recommended-reading-for-allies/"><span style="font-weight: 400;">reading list</span></a><span style="font-weight: 400;"> that would make a great starting point.)</span></p>
<p><span style="font-weight: 400;">While you’re reading, be aware that feminism isn&#8217;t a monolithic block of thought. There are a wide variety of viewpoints on the topic. Be sensitive to the possibility that what you&#8217;ve learned is just one viewpoint.</span></p>
<p><span style="font-weight: 400;">As an ally, you will never stop learning. Keep actively seeking out new writing and material so that you can deepen your understanding.</span></p>
<h3><span style="font-weight: 400;">2. Expand your network</span></h3>
<p><span style="font-weight: 400;">A great way to expand your understanding of feminism and gender issues is to expand and diversify your network. Make sure to follow your female and non-binary colleagues on social media. Then, make a habit of following the other folks they retweet or mention.</span></p>
<p><span style="font-weight: 400;">If you’d like to introduce yourself to a woman at your workplace or at a conference, do so! Just remember to keep the discussion technical and on-topic: talk to them because you’d like to know more about that new machine learning model they implemented, not because you need more diverse friends.</span></p>
<h3><span style="font-weight: 400;">3. Listen and believe</span></h3>
<p><span style="font-weight: 400;">Now that you have a good number of women and non-binary folks in your network, listen to them! Arguably the biggest thing you can do as an ally is to listen. Listen to the stories of the difficulties they&#8217;ve faced and the problems they&#8217;re experiencing in the workplace. When you hear their stories, </span><i><span style="font-weight: 400;">especially</span></i><span style="font-weight: 400;"> ones that don&#8217;t fit with your mental model of your workplace or environment, believe them. No &#8220;aren&#8217;t you over-reacting?&#8221; No &#8220;I think you&#8217;ve misunderstood.&#8221; If they tell you there&#8217;s a problem, there&#8217;s a problem. So listen.</span></p>
<p><span style="font-weight: 400;">After listening, ask how you can help. Ask how you can support them in resolving the problem. It doesn&#8217;t have to be you doing the solving—your colleagues aren&#8217;t helpless damsels in distress—but your support can be invaluable.</span></p>
<p><span style="font-weight: 400;">One of the most difficult things to listen to is criticism of </span><i><span style="font-weight: 400;">yourself</span></i><span style="font-weight: 400;"> and your actions. You still need to listen and believe and learn.</span></p>
<p><span style="font-weight: 400;">But just because you haven&#8217;t been </span><i><span style="font-weight: 400;">told</span></i><span style="font-weight: 400;"> there&#8217;s a problem, that doesn&#8217;t mean there </span><i><span style="font-weight: 400;">isn&#8217;t</span></i><span style="font-weight: 400;"> one. Speaking about experiences of discrimination is often very difficult, because it tends to be very, very risky. Marginalized people who report discrimination often find that </span><a href="https://www.tnwinc.com/2600/retaliation-rise-reporting/"><span style="font-weight: 400;">doing so negatively impacts their careers</span></a><span style="font-weight: 400;">. When they raise issues, they get labeled complainers or trouble-makers, while those they complain about see no consequences or repercussions for their actions.</span></p>
<p><span style="font-weight: 400;">Remember that you have no reason to expect that they will share their stories or concerns with you. These are not conversations that men, </span><i><span style="font-weight: 400;">even well-meaning allies</span></i><span style="font-weight: 400;">, should initiate. Don’t ask for these conversations, but when they happen, listen and believe.</span></p>
<h3><span style="font-weight: 400;">4. Notice the small stuff</span></h3>
<p><span style="font-weight: 400;">Your colleagues aren’t going to tell you about every bad experience; in fact, they won’t tell you about most of them. You can help by noticing problems by yourself and addressing them.</span></p>
<p><span style="font-weight: 400;">Microaggressions—the small stuff—are some of the most subtly toxic behaviors that women and non-binary people have to deal with. Microaggressions slowly eat away at their self-confidence and patience.</span></p>
<p><span style="font-weight: 400;">When you see some small inequity, mention it. If a colleague interrupts a woman, say, &#8220;I&#8217;d like to hear what __ was saying&#8221;. If a colleague assumes a woman will take notes, say, &#8220;I think __ could have some useful insights on this topic—could somebody else take notes so that she can participate more actively?&#8221; or possibly, &#8220;Have we considered a formal note-taking rotation to ensure that we&#8217;re not making gendered assumptions about who will do the clerical work?&#8221;</span></p>
<p><span style="font-weight: 400;">Try to also consider whether your comment will put the colleague who suffered the inequity in an uncomfortable position. If you’re not sure what to do, you should wait, talk to them privately, then defer to their decision on what further action should be taken. They may wish for you to speak with the person directly on their behalf or they may prefer for you to go to a manager. They may not want you to do anything at all (perhaps because they have plans to address this on their own). Sometimes the very recognition of the microaggression is enough! Remember: they don&#8217;t need you to save them, but your support and validation can be very valuable.</span></p>
<p><span style="font-weight: 400;">If you raise things like this with a colleague, it may feel &#8220;nitpicky&#8221;. It will certainly feel uncomfortable. But many productive and important conversations are uncomfortable! As an ally, you should be prepared to shoulder a bit of the discomfort and awkwardness that women and non-binary people experience every day.</span></p>
<p><span style="font-weight: 400;">You can also work on “anti-microaggressions”—small acts to nudge the culture in the opposite direction. Examples might include making sure a diverse range of people are featured in your </span><a href="http://qz.com/542219/im-a-slack-designer-and-my-world-changed-when-i-made-an-emoji-with-brown-skin-like-mine/"><span style="font-weight: 400;">illustrations</span></a><span style="font-weight: 400;">, </span><a href="http://www.wocintechchat.com/blog/wocintechphotos"><span style="font-weight: 400;">slide decks</span></a><span style="font-weight: 400;">, user stories, etc., or that you pay attention to </span><a href="http://www.moishelettvin.com/2014/08/30/save-us-princess/"><span style="font-weight: 400;">gendered language in your tools</span></a><span style="font-weight: 400;">.</span></p>
<h3><span style="font-weight: 400;">5. Teach others</span></h3>
<p><span style="font-weight: 400;">Another way you can share the load is by teaching. Women and non-binary individuals are constantly expected to teach others about feminism and gender issues. It can be a great burden. Help them out by doing some of the teaching.</span></p>
<p><span style="font-weight: 400;">Have honest conversations with the people you work with, particularly if you observe behaviors that you know (or suspect) may have a discriminatory effect on your other colleagues. Remember that, most of the time, these behaviors are unconscious, or learned in different work environments. Talking about negative behaviors without blame and educating the men you work with helps them become better colleagues, and in the vast majority of cases it&#8217;ll be well-received.</span></p>
<p><span style="font-weight: 400;">In addition to educating other men, encourage them to speak up if they see instances of bias. The more men there are working on this, the easier it will be to make your workplace a more egalitarian environment.</span></p>
<h3><span style="font-weight: 400;">6. Amplify and endorse</span></h3>
<p><span style="font-weight: 400;">There is no point in having equality of numbers if there is no equality of influence. As such, we have to </span><a href="http://qz.com/781404/women-at-the-white-house-have-started-using-the-simple-trick-of-amplification-to-get-heard-not-interrupted"><span style="font-weight: 400;">make sure that people from underrepresented groups are heard in meetings</span></a><span style="font-weight: 400;">, that they have a chance to speak, and that their views are considered and respected. The frustration of not being able to contribute, or being ignored or belittled, is a fast track to quitting.</span></p>
<p><span style="font-weight: 400;">One type of unconscious bias is called &#8220;listener bias&#8221;. We are socialized to </span><a href="http://www.bbc.com/future/story/20131112-do-women-talk-more-than-men"><span style="font-weight: 400;">think that women talk more in general</span></a><span style="font-weight: 400;">, and so tend to significantly overestimate the actual amount of time women spend talking in discussions, to the extent that we can think that women are dominating conversation when in fact </span><a href="http://dx.doi.org/10.1017/S0142716400008882"><span style="font-weight: 400;">men are doing most of the talking</span></a><span style="font-weight: 400;">. As always, be aware of this unconscious bias. Correct for it by inviting your female and non-binary colleagues to offer their opinion in a meeting.</span></p>
<p><span style="font-weight: 400;">Make sure that women and non-binary individuals in your company have the opportunity to work on high-profile projects. If you make staffing decisions, pay attention to gender bias when considering who gets what role. If you&#8217;re not making those decisions, you can still advocate and lobby for them within your organization. Support and encourage them, but don&#8217;t micromanage them, or do all the work for them. Trust their expertise. You hired them, so they must be talented. If you don’t make use of their talents, not only do you lose out in the short term, but they’ll also eventually quit and you’ll lose out massively in the long term.</span></p>
<p><span style="font-weight: 400;">Also make sure they get credit for their accomplishments and contributions. Make sure they get to brag about what they&#8217;ve achieved. Approve of this behavior, rather than branding them as arrogant or conceited. Remember that society tends to consider modesty a virtue for women, but not men.</span></p>
<p><span style="font-weight: 400;">Amplify their voices outside of your workplace, too. If you&#8217;re invited to speak in public, ask yourself if there&#8217;s a woman or non-binary individual equally—or more!—qualified to speak on the topic. Pay attention to gender balance in panels and speaker line-ups at conferences you&#8217;re planning to participate in. Ask the organizer why their panel lacks diversity. Ask to see their </span><a href="https://codeascraft.com/about/code-of-conduct/"><span style="font-weight: 400;">Code of Conduct</span></a><span style="font-weight: 400;">, and if they don’t have one, </span><a href="https://www.ashedryden.com/blog/codes-of-conduct-101-faq"><span style="font-weight: 400;">encourage them to change that</span></a><span style="font-weight: 400;">. Consider not attending events without a code of conduct or refusing to sit on a panel that only includes men.</span></p>
<p><span style="font-weight: 400;">Social media is another excellent way to increase the visibility of underrepresented genders. If you’ve followed the advice earlier, you’re following women and non-binary folks on social media and have diversified your network, but consider also retweeting and promoting them. If they share a blog post, consider retweeting them instead of writing your own tweet with a link to the same content. Amplify their voices. Even small acts like retweeting can greatly increase their visibility and introduce your followers to more diverse opinions and ideas.</span></p>
<h3><span style="font-weight: 400;">7. Recruit fairly</span></h3>
<p><span style="font-weight: 400;">You know what else helps with gender diversity? Having more diverse people on staff! This might feel like it’s easier said than done, but there are concrete steps you can take to increase the gender diversity of your team.</span></p>
<p><span style="font-weight: 400;">The first step, which we’ve already addressed, is expanding your network. We tend to do a lot of recruitment from our personal networks, so having a diverse network can make a tremendous impact on the variety of candidates we can recruit.</span></p>
<p><span style="font-weight: 400;">Take the time and effort to review your job postings for gendered language: could your words make someone feel excluded or </span><a href="https://hbr.org/2014/08/why-women-dont-apply-for-jobs-unless-theyre-100-qualified"><span style="font-weight: 400;">unqualified</span></a><span style="font-weight: 400;">? Look at where your jobs are advertised: are you going to reach a diverse audience?</span></p>
<p><span style="font-weight: 400;">After you&#8217;ve established a diverse pool of applicants, you need to make sure the rest of the process is as fair and unbiased as possible.</span></p>
<p><span style="font-weight: 400;">When reviewing résumés, be explicitly aware of your unconscious biases to make sure you don&#8217;t filter candidates out for the wrong reasons. This doesn’t mean you’re purposely rejecting someone just because you think they’re female. Rather, you might reject someone because they haven&#8217;t described their accomplishments the way you might expect. Remember: women are conditioned to be modest and may under-report all the good stuff they’ve done.</span></p>
<p><span style="font-weight: 400;">There may be other reasons why they don’t conform to your preconceptions of the &#8220;ideal candidate&#8221;. For example, maybe you’d expect someone with their experience to have a long history of giving conference talks, but they haven&#8217;t been speaking at conferences because they perceive conferences as hostile environments.</span></p>
<p><span style="font-weight: 400;">When it comes to interview time, be mindful of the fact that there are a myriad of ways to be a successful employee and different candidates will excel in different environments. Using a diverse set of interview styles is beneficial for </span><i><span style="font-weight: 400;">all</span></i><span style="font-weight: 400;"> candidates. Not everyone does well in aggressive &#8220;knowledge test&#8221;-style interviews. Some are better on a whiteboard, some are better at a keyboard, others respond well to discussion.</span></p>
<p><span style="font-weight: 400;">This is not to say that we should lower the bar for recruitment; rather, we should accept that we may be using the wrong measuring stick. Expecting everyone to act and respond in a particular way is the very </span><i><span style="font-weight: 400;">opposite</span></i><span style="font-weight: 400;"> of recruiting for diverse viewpoints and experiences.</span></p>
<p><span style="font-weight: 400;">On the subject of recruiting women, it’s worth addressing &#8220;the pipeline problem&#8221;. This is the idea that we can’t hire more women because women aren’t studying computer science. This is </span><a href="https://medium.com/tech-diversity-files/if-you-think-women-in-tech-is-just-a-pipeline-problem-you-haven-t-been-paying-attention-cb7a2073b996"><span style="font-weight: 400;">somewhat correct, but entirely misleading</span></a><span style="font-weight: 400;">. Women are not achieving computer science degrees at the same rate as men, it’s true, but the number of women active in the industry is much lower than the total number of women with relevant degrees (and that’s not counting the women who are capable self-taught programmers). Today, women earn 18% of CS degrees. </span><a href="http://www.computerworld.com/article/2474991/it-careers/women-computer-science-grads--the-bump-before-the-decline.html"><span style="font-weight: 400;">In 1984, they earned 37% of CS degrees</span></a><span style="font-weight: 400;">. These women are only in their 50s and still active in the industry. What happened to them? Clearly, the pipeline is not the only problem.</span></p>
<p><span style="font-weight: 400;">What good does it do us if we hire a load of great women and non-binary people, then they all quit because they arrive in a toxic work environment? <a href="https://twitter.com/ashedryden/status/392052865709002752">What if the pipeline leads to a sewage plant</a>?</span></p>
<h3><span style="font-weight: 400;">8. Model and support sustainable work</span></h3>
<p><span style="font-weight: 400;">In tech, particularly, women quit the industry completely with </span><a href="https://www.ncwit.org/sites/default/files/resources/womenintech_facts_fullreport_05132016.pdf"><span style="font-weight: 400;">much higher frequency than men</span></a><span style="font-weight: 400;">. They often leave not just because of sexist behaviors directly, but for a variety of complex reasons.</span></p>
<p><span style="font-weight: 400;">The expectations of the workplace can place an unreasonable load on all employees. Men are generally expected to meet those demands at the expense of family and personal life, while women are expected to do the opposite. The assumption that women will not have the time to meet these unreasonable demands is one way that society justifies the wage gap. Then, if a couple decides that one of them should stay home to care for the family, who do you think typically quits their job? The woman! Because we pay her less! But we pay her less because we expected her to leave!</span></p>
<p><span style="font-weight: 400;">In order to keep women in the industry, we need to pay them equally. More than that: we need to create a culture that supports sustainable work in a way that doesn’t pit employees’ personal and professional lives against each other. In doing so, companies invest in employees’ overall health, happiness, and engagement in their work. Your company may have unlimited vacation time or flexible working arrangements, but do your employees </span><a href="https://www.washingtonpost.com/news/wonk/wp/2016/06/19/why-men-fear-paternity-leave/"><span style="font-weight: 400;">feel comfortable </span><i><span style="font-weight: 400;">actually using those benefits</span></i></a><i><span style="font-weight: 400;">?</span></i></p>
<p><span style="font-weight: 400;">Allies can help by actively participating in and supporting a sustainable work culture. They can normalize behaviors such as taking vacation, taking time for family, not working all hours, etc. Etsy’s CEO Chad Dickerson, for example, took full advantage of Etsy’s </span><a href="https://blog.etsy.com/news/2016/strong-families-strong-business-a-step-forward-in-parental-leave-at-etsy/"><span style="font-weight: 400;">parental leave benefits</span></a><span style="font-weight: 400;"> (5 weeks at the time, now 26 weeks for all new parents) to help care for his family. More leaders should demonstrate that you can lead robust personal and professional lives that can enhance and support each other. </span></p>
<p><span style="font-weight: 400;">People of all genders should certainly still be able to opt out of the workplace to concentrate on their families, but that should be a choice, rather than an ultimatum.</span></p>
<h3><span style="font-weight: 400;">9. Don’t lead, follow</span></h3>
<p><span style="font-weight: 400;">Allies are there to share the load, not to take the lead. Allies simply haven’t lived the same experiences as those with whom they are allied. No amount of listening and learning will give you first-hand understanding of a person’s experiences! </span></p>
<p><span style="font-weight: 400;">Men are typically used to leading and taking charge, but women and non-binary individuals are perfectly capable of fighting their battles and defending themselves: they don’t need a man to step in to save them. What they need from men is support and understanding to make it easier, and for men to do their part so that eventually those battles don’t have to be fought in the first place.</span></p>
<h3><span style="font-weight: 400;">10. Show up</span></h3>
<p><span style="font-weight: 400;">Show up. Every day. Allyship isn&#8217;t something you can do in your spare time or only when it&#8217;s convenient for you. It&#8217;s effort, it&#8217;s work—often hard work. Show up, every day, and don&#8217;t let it slip.</span></p>
<p><span style="font-weight: 400;">Showing up includes a healthy dose of self-reflection and self-awareness. Think carefully about your own actions and behaviors—remember that unconscious bias is deeply entrenched and will rear up when you least expect it.</span></p>
<p><span style="font-weight: 400;">And don’t stop at supporting women and non-binary people at work. Learn about the issues faced by other underrepresented groups and how to apply your allyship skills to supporting them too.</span></p>
<p><span style="font-weight: 400;">Don’t expect a cookie, though. Actively working to correct injustices should be the baseline, not something special you deserve to be rewarded for. Do the work because the work matters, not because it looks good on your résumé, and give credit to those who helped you get there.</span></p>
<p><span style="font-weight: 400;">Being an ally is </span><i><span style="font-weight: 400;">hard</span></i><span style="font-weight: 400;">. It takes time and work and effort. Fundamentally, men could avoid this time and work and effort. Society doesn&#8217;t expect men to be allies. Men have the privilege of being able to ignore these problems if they want to. We hope this post has helped to persuade you that being an ally is important, but also achievable. You can make a difference—a huge difference—if you step up.</span></p>
<h2><span style="font-weight: 400;">Acknowledgements</span></h2>
<p><span style="font-weight: 400;">The material for this post was inspired (and immeasurably improved) by many women and non-binary people—at Etsy and beyond—who shared their knowledge and experience with us. We’re grateful for their time and effort.</span></p>
<p><span style="font-weight: 400;">We&#8217;d also like to acknowledge the contributions and feedback from men at Etsy who have reflected on their successes—and failures—as allies and shared what they&#8217;ve learned.</span></p>
<p><span style="font-weight: 400;">We also owe a debt to some of the resources made available by </span><a href="https://www.ncwit.org"><span style="font-weight: 400;">NCWIT</span></a><span style="font-weight: 400;"> and </span><a href="https://adainitiative.org/continue-our-work/workshops-and-training/"><span style="font-weight: 400;">The Ada Initiative</span></a><span style="font-weight: 400;">, as well as the countless people who have written books, blog posts, and talks that have helped us gain a better understanding of this complex topic.</span></p>
<h2><span style="font-weight: 400;">Bibliography</span></h2>
<p><span style="font-weight: 400;">This post references a number of external studies and articles on the research behind issues of diversity in tech and society in general, which are listed below. For more information on the business of allyship, check out our </span><a href="https://codeascraft.com/2016/08/10/recommended-reading-for-allies/"><span style="font-weight: 400;">list of recommended reading for allies</span></a><span style="font-weight: 400;">.</span></p>
<ul>
<li style="font-weight: 400;"><a href="http://www.payscale.com/data-packages/gender-pay-gap"><span style="font-weight: 400;">Understanding the Gender Pay Gap</span></a><span style="font-weight: 400;">, Payscale</span></li>
<li style="font-weight: 400;"><a href="https://kateheddleston.com/blog/argument-cultures-and-unregulated-aggression"><span style="font-weight: 400;">Argument Cultures and Unregulated Aggression</span></a><span style="font-weight: 400;">, Heddleston</span></li>
<li style="font-weight: 400;"><a href="http://www.independent.co.uk/news/business/women-bosses-more-likely-to-be-called-bitchy-emotional-and-bossy-10090606.html"><span style="font-weight: 400;">Women bosses more likely to be called &#8216;bitchy&#8217;, &#8217;emotional&#8217; and &#8216;bossy&#8217;</span></a><span style="font-weight: 400;">, Sheffield</span></li>
<li style="font-weight: 400;"><a href="http://fortune.com/2014/08/26/performance-review-gender-bias/"><span style="font-weight: 400;">The abrasiveness trap</span></a><span style="font-weight: 400;">, Snyder</span></li>
<li style="font-weight: 400;"><a href="https://hbr.org/2016/04/were-making-the-wrong-case-for-diversity-in-silicon-valley"><span style="font-weight: 400;">We’re Making the Wrong Case for Diversity in Silicon Valley</span></a><span style="font-weight: 400;">, Pittinsky</span></li>
<li style="font-weight: 400;"><a href="https://www.tnwinc.com/2600/retaliation-rise-reporting/"><span style="font-weight: 400;">The Persistence of Retaliation Against Employees</span></a><span style="font-weight: 400;">, Knezevich</span></li>
<li style="font-weight: 400;"><a href="http://qz.com/542219/im-a-slack-designer-and-my-world-changed-when-i-made-an-emoji-with-brown-skin-like-mine/"><span style="font-weight: 400;">I’m a Slack designer, and my world changed when I made an emoji with brown skin like mine</span></a><span style="font-weight: 400;">, Brito</span></li>
<li style="font-weight: 400;"><a href="http://www.moishelettvin.com/2014/08/30/save-us-princess/"><span style="font-weight: 400;">Save us, Princess!</span></a><span style="font-weight: 400;">, Lettvin</span></li>
<li style="font-weight: 400;"><a href="http://qz.com/781404/women-at-the-white-house-have-started-using-the-simple-trick-of-amplification-to-get-heard-not-interrupted/"><span style="font-weight: 400;">Women at the White House have started using a simple, clever trick to get heard</span></a><span style="font-weight: 400;">, Werber</span></li>
<li style="font-weight: 400;"><a href="http://www.bbc.com/future/story/20131112-do-women-talk-more-than-men"><span style="font-weight: 400;">Prattle of the sexes</span></a><span style="font-weight: 400;">, Hammond</span></li>
<li style="font-weight: 400;"><a href="https://www.cambridge.org/core/journals/applied-psycholinguistics/article/speaker-sex-and-perceived-apportionment-of-talk/16666BA97B7BE41FFB16A5693BF60C23"><span style="font-weight: 400;">Speaker sex and perceived apportionment of talk</span></a><span style="font-weight: 400;">, Cutler, Scott</span></li>
<li style="font-weight: 400;"><a href="https://www.ashedryden.com/blog/codes-of-conduct-101-faq"><span style="font-weight: 400;">Code of Conduct 101 + FAQ</span></a><span style="font-weight: 400;">, Dryden</span></li>
<li style="font-weight: 400;"><a href="https://hbr.org/2014/08/why-women-dont-apply-for-jobs-unless-theyre-100-qualified"><span style="font-weight: 400;">Why Women Don’t Apply for Jobs Unless They’re 100% Qualified</span></a><span style="font-weight: 400;">, Mohr</span></li>
<li style="font-weight: 400;"><a href="https://medium.com/tech-diversity-files/if-you-think-women-in-tech-is-just-a-pipeline-problem-you-haven-t-been-paying-attention-cb7a2073b996#.lnu0xua2u"><span style="font-weight: 400;">If you think women in tech is just a pipeline problem, you haven’t been paying attention</span></a><span style="font-weight: 400;">, Thomas</span></li>
<li style="font-weight: 400;"><a href="http://www.computerworld.com/article/2474991/it-careers/women-computer-science-grads--the-bump-before-the-decline.html"><span style="font-weight: 400;">Women computer science grads: The bump before the decline</span></a><span style="font-weight: 400;">, Mitchell</span></li>
<li style="font-weight: 400;"><a href="https://www.ncwit.org/sites/default/files/resources/womenintech_facts_fullreport_05132016.pdf"><span style="font-weight: 400;">Women In Tech: The Facts</span></a><span style="font-weight: 400;">, Ashcraft, McClain, Eger</span></li>
<li style="font-weight: 400;"><a href="https://www.washingtonpost.com/news/wonk/wp/2016/06/19/why-men-fear-paternity-leave/"><span style="font-weight: 400;">Why men fear paternity Leave</span></a><span style="font-weight: 400;">, Paquette</span></li>
<li style="font-weight: 400;"><a href="https://blog.etsy.com/news/2016/strong-families-strong-business-a-step-forward-in-parental-leave-at-etsy/"><span style="font-weight: 400;">Strong Families, Strong Business: A Step Forward in Parental Leave at Etsy</span></a><span style="font-weight: 400;">, Gorman</span></li>
</ul>
]]></content>
		<link rel="replies" type="text/html"
			  href="https://codeascraft.com/2016/10/19/being-an-effective-ally-to-women-and-non-binary-people/#comments"
			  thr:count="3"/>
		<link rel="replies" type="application/atom+xml"
			  href="https://codeascraft.com/2016/10/19/being-an-effective-ally-to-women-and-non-binary-people/feed/atom/"
			  thr:count="3"/>
		<thr:total>3</thr:total>
	</entry>
</feed>
